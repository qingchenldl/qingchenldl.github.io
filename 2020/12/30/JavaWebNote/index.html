<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="JavaWeb笔记"><meta name="keywords" content="Java"><meta name="author" content="V0WKeep3r,v0wldl@163.com"><meta name="copyright" content="V0WKeep3r"><title>JavaWeb笔记 | V0W's Blog</title><link rel="shortcut icon" href="/favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.9.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.9.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容:${query}"}},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  hexoVersion: '5.2.0'
} </script><meta name="generator" content="Hexo 5.2.0"><link rel="alternate" href="/atom.xml" title="V0W's Blog" type="application/atom+xml">
</head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="切换文章详情">切换站点概览</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#0x01-tomcat"><span class="toc-text">0x01 tomcat</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-1-%E4%B8%8B%E8%BD%BDtomcat"><span class="toc-text">1.1 下载tomcat</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-2-%E9%85%8D%E7%BD%AEtomcat"><span class="toc-text">1.2 配置tomcat</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x02-Maven"><span class="toc-text">0x02 Maven</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1-%E4%B8%8B%E8%BD%BDMaven"><span class="toc-text">2.1 下载Maven</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2-%E9%85%8D%E7%BD%AE%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F"><span class="toc-text">2.2 配置环境变量</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-3-%E9%85%8D%E7%BD%AE%E9%98%BF%E9%87%8C%E4%BA%91%E9%95%9C%E5%83%8F"><span class="toc-text">2.3 配置阿里云镜像</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-4-IDEA%E4%B8%8B%E4%BD%BF%E7%94%A8Maven"><span class="toc-text">2.4 IDEA下使用Maven</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-5-IDEA-%E9%85%8D%E7%BD%AEtomcat"><span class="toc-text">2.5 IDEA 配置tomcat</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-6-pom-xml%E6%96%87%E4%BB%B6"><span class="toc-text">2.6 pom.xml文件</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x03-Servlet"><span class="toc-text">0x03 Servlet</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#3-1-Servlet-%E7%AE%80%E4%BB%8B"><span class="toc-text">3.1 Servlet 简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-2-HelloServlet"><span class="toc-text">3.2 HelloServlet</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-3-Servlet%E5%8E%9F%E7%90%86"><span class="toc-text">3.3 Servlet原理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-4-Mapping%E9%97%AE%E9%A2%98"><span class="toc-text">3.4 Mapping问题</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-5-ServletContext"><span class="toc-text">3.5 ServletContext</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-6-HttpServletRequest"><span class="toc-text">3.6 HttpServletRequest</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-6-1-%E8%8E%B7%E5%8F%96%E8%AF%B7%E6%B1%82%E5%8F%82%E6%95%B0"><span class="toc-text">3.6.1 获取请求参数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-6-2-%E8%AF%B7%E6%B1%82%E8%BD%AC%E5%8F%91"><span class="toc-text">3.6.2 请求转发</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-7-HttpServletResponse"><span class="toc-text">3.7 HttpServletResponse</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-7-1-%E4%B8%8B%E8%BD%BD%E6%96%87%E4%BB%B6"><span class="toc-text">3.7.1 下载文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-7-2-%E9%AA%8C%E8%AF%81%E7%A0%81"><span class="toc-text">3.7.2 验证码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-7-3-%E5%AE%9E%E7%8E%B0%E9%87%8D%E5%AE%9A%E5%90%91"><span class="toc-text">3.7.3 实现重定向</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-8-Cookie"><span class="toc-text">3.8 Cookie</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-9-Session"><span class="toc-text">3.9 Session</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x04-JSP"><span class="toc-text">0x04 JSP</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#4-1-JSP%E5%8E%9F%E7%90%86"><span class="toc-text">4.1 JSP原理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-2-JSP%E8%AF%AD%E6%B3%95"><span class="toc-text">4.2 JSP语法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-3-JSP%E6%8C%87%E4%BB%A4"><span class="toc-text">4.3 JSP指令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-4-%E4%B9%9D%E5%A4%A7%E5%86%85%E7%BD%AE%E5%AF%B9%E8%B1%A1"><span class="toc-text">4.4 九大内置对象</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-5-jsp%E6%A0%87%E7%AD%BE-amp-JSTL%E8%A1%A8%E8%BE%BE%E5%BC%8F-amp-EL%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="toc-text">4.5 jsp标签&amp;JSTL表达式&amp;EL表达式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#jsp%E6%A0%87%E7%AD%BE"><span class="toc-text">jsp标签</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#JSTL%E6%A0%87%E7%AD%BE"><span class="toc-text">JSTL标签</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#EL%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="toc-text">EL表达式</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x05-MVC%E6%A1%86%E6%9E%B6"><span class="toc-text">0x05 MVC框架</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x06-Filter"><span class="toc-text">0x06 Filter</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x07-Listener-%E7%9B%91%E5%90%AC%E5%99%A8"><span class="toc-text">0x07 Listener 监听器</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x08-JSON"><span class="toc-text">0x08 JSON</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#8-1-%E7%AE%80%E4%BB%8B%E4%B8%8E%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8"><span class="toc-text">8.1 简介与简单使用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-2-FastJson"><span class="toc-text">8.2 FastJson</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#8-2-1-%E7%AE%80%E4%BB%8B"><span class="toc-text">8.2.1 简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-2-2-%E4%BD%BF%E7%94%A8"><span class="toc-text">8.2.2 使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-2-3-%E5%B0%86Java%E5%AF%B9%E8%B1%A1%E8%BD%AC%E6%8D%A2%E6%88%90Json%E6%A0%BC%E5%BC%8F%E5%AD%97%E7%AC%A6%E4%B8%B2%EF%BC%88%E5%BA%8F%E5%88%97%E5%8C%96%EF%BC%89"><span class="toc-text">8.2.3 将Java对象转换成Json格式字符串（序列化）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-2-4-%E5%88%9B%E5%BB%BAJson%E5%AF%B9%E8%B1%A1"><span class="toc-text">8.2.4 创建Json对象</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-2-5-Json%E6%A0%BC%E5%BC%8F%E5%AD%97%E7%AC%A6%E4%B8%B2%E8%A7%A3%E6%9E%90%E6%88%90Java%E5%AF%B9%E8%B1%A1-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96"><span class="toc-text">8.2.5 Json格式字符串解析成Java对象(反序列化)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-3-Jackson"><span class="toc-text">8.3 Jackson</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#8-3-1-%E7%AE%80%E4%BB%8B"><span class="toc-text">8.3.1 简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-3-2-Java-%E5%AF%B9%E8%B1%A1%E8%BD%ACJson%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="toc-text">8.3.2 Java 对象转Json字符串</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-3-3-Json-%E5%AD%97%E7%AC%A6%E4%B8%B2%E8%BD%ACJava%E5%AF%B9%E8%B1%A1"><span class="toc-text">8.3.3 Json 字符串转Java对象</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-4-Gson"><span class="toc-text">8.4 Gson</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x09-Ajax"><span class="toc-text">0x09 Ajax</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#9-1-%E7%94%A8%E9%80%94"><span class="toc-text">9.1 用途</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-2-%E5%8E%9F%E7%90%86%E4%B8%8E%E7%BC%96%E5%86%99"><span class="toc-text">9.2 原理与编写</span></a></li></ol></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="/img/Kaneki.jpg"></div><div class="author-info__name text-center">V0WKeep3r</div><div class="author-info__description text-center">Stay Hungry, Stay Foolish.</div><div class="follow-button"><a target="_blank" rel="noopener" href="https://github.com/qingchenldl">Follow Me</a></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">文章</span><span class="pull-right">53</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">标签</span><span class="pull-right">35</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">分类</span><span class="pull-right">11</span></a></div><hr><div class="author-info-links"><div class="author-info-links__title text-center">友链</div><a class="author-info-links__name text-center" target="_blank" rel="noopener" href="https://zhuxianjin.github.io/">J0k3r</a><a class="author-info-links__name text-center" target="_blank" rel="noopener" href="http://p0desta.com/">p0desta</a><a class="author-info-links__name text-center" target="_blank" rel="noopener" href="https://daolgts.github.io/">dlgts</a><a class="author-info-links__name text-center" target="_blank" rel="noopener" href="http://iwenhu.cn/">mengchen</a><a class="author-info-links__name text-center" target="_blank" rel="noopener" href="http://p0sec.net/">p0</a><a class="author-info-links__name text-center" target="_blank" rel="noopener" href="http://asa9ao.xyz/">唯湖</a><a class="author-info-links__name text-center" target="_blank" rel="noopener" href="http://seaii-blog.com/">seaii</a><a class="author-info-links__name text-center" target="_blank" rel="noopener" href="http://wzt.ac.cn/">WCatalpa.T</a><a class="author-info-links__name text-center" target="_blank" rel="noopener" href="http://syf.ac.cn/">7N1ght</a><a class="author-info-links__name text-center" target="_blank" rel="noopener" href="http://www.nicefish.top/posts/">nicefish</a><a class="author-info-links__name text-center" target="_blank" rel="noopener" href="http://flag0.com/">GetFlag</a><a class="author-info-links__name text-center" target="_blank" rel="noopener" href="https://is4b3lla3.github.io">lsabellae</a></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(/img/index.jpg)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">V0W's Blog</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">主页</a><a class="site-page" href="/archives">文章</a><a class="site-page" href="/tags">标签</a><a class="site-page" href="/categories">分类</a><a class="site-page" href="/about">关于我</a></span><span class="pull-right"><a class="site-page social-icon search"><i class="fa fa-search"></i><span> 搜索</span></a></span></div><div id="post-info"><div id="post-title">JavaWeb笔记</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-12-30</time><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/%E7%BC%96%E7%A8%8B%E7%AE%97%E6%B3%95/">编程算法</a><div class="post-meta-wordcount"><span>字数总计: </span><span class="word-count">11k</span><span class="post-meta__separator">|</span><span>阅读时长: 55 分钟</span></div></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><h1 id="0x01-tomcat"><a href="#0x01-tomcat" class="headerlink" title="0x01 tomcat"></a>0x01 tomcat</h1><p>tomcat是一个服务器中间件，用于运行java web的服务程序，特点是轻量级，适合初学者进行部署和学习。</p>
<h2 id="1-1-下载tomcat"><a href="#1-1-下载tomcat" class="headerlink" title="1.1 下载tomcat"></a>1.1 下载tomcat</h2><p>官网：<a target="_blank" rel="noopener" href="https://tomcat.apache.org/">https://tomcat.apache.org/</a></p>
<p>可以选择不同的版本，复现一些特殊的漏洞，可能依赖不同的tomcat版本。如果直接不能下载相应版本，我们可以通过<br><a target="_blank" rel="noopener" href="https://tomcat.apache.org/download-70.cgi">https://tomcat.apache.org/download-70.cgi</a> 下载7版本的tomcat。可以在archive下选择不同的小版本。<br>开发的话，一般选择最新即可。</p>
<h2 id="1-2-配置tomcat"><a href="#1-2-配置tomcat" class="headerlink" title="1.2 配置tomcat"></a>1.2 配置tomcat</h2><p>如果是使用IDEA等IDE进行java编写和部署，一般不需要单独把tomcat配置环境变量。如果需要的话，可以按照这样的步骤进行配置：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">打开终端，输入：</span><br><span class="line">open .bash_profile</span><br><span class="line"></span><br><span class="line">打开.bash_profile，编辑，插入如下语句（当然你也可以用vim编辑）:</span><br><span class="line">export PATH&#x3D;$PATH:&#x2F;Users&#x2F;v0w&#x2F;Environment&#x2F;tomcat&#x2F;apache-tomcat-9.0.41&#x2F;bin</span><br><span class="line"></span><br><span class="line">其中&#x2F;Users&#x2F;v0w&#x2F;Environment&#x2F;tomcat&#x2F;apache-tomcat-9.0.41&#x2F;bin是路径名，对应自己的路径名即可。</span><br><span class="line"></span><br><span class="line">然后保存关闭。再在终端执行：</span><br><span class="line">source ～&#x2F;.bash_profile</span><br><span class="line"></span><br><span class="line">此时你可以在终端尝试如下命令启动tomcat服务：</span><br><span class="line">startup.sh</span><br><span class="line">version.sh</span><br></pre></td></tr></table></figure>
<p><img src="https://image.v0w.top/2020/12/16079550000910.jpg"></p>
<p><strong>配置文件</strong><br>tomcat的配置文件是<code>/conf/server.xml</code></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--通过设置这里的port，更改java web的服务端口--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Connector</span> <span class="attr">port</span>=<span class="string">&quot;8080&quot;</span> <span class="attr">protocol</span>=<span class="string">&quot;HTTP/1.1&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">connectionTimeout</span>=<span class="string">&quot;20000&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">redirectPort</span>=<span class="string">&quot;8443&quot;</span> /&gt;</span></span><br><span class="line"><span class="comment">&lt;!--通过修改这里的name，设置不同的hostname--&gt;</span>          </span><br><span class="line">      <span class="tag">&lt;<span class="name">Host</span> <span class="attr">name</span>=<span class="string">&quot;localhost&quot;</span>  <span class="attr">appBase</span>=<span class="string">&quot;webapps&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">unpackWARs</span>=<span class="string">&quot;true&quot;</span> <span class="attr">autoDeploy</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>tomcat的默认javaweb应用的配置文件是<code>/conf/web.xml</code><br>用来配置javaweb的路由，过滤器等，<br>当然，在存在<code>/webapps/ROOT/WEB-INF/web.xml</code>时，以此为webapps的<code>web.xml</code>为优先的web配置。<br><img src="https://image.v0w.top/2020/12/16079561796429.jpg"></p>
<h1 id="0x02-Maven"><a href="#0x02-Maven" class="headerlink" title="0x02 Maven"></a>0x02 Maven</h1><p>一个javaWeb项目在开发过程中，可能需要使用很多的jar包，需要开发者自行导入，这样的话，非常繁琐复杂。Maven工具可以帮助我们自动的导入jar包。</p>
<h2 id="2-1-下载Maven"><a href="#2-1-下载Maven" class="headerlink" title="2.1 下载Maven"></a>2.1 下载Maven</h2><p>打开Maven官网下载页面: <a target="_blank" rel="noopener" href="https://maven.apache.org/download.cgi">https://maven.apache.org/download.cgi</a><br>下载: <code>apache-maven-3.6.3-bin.tar.gz</code><br>解压下载的安装包到某一目录，比如：<code>/Users/xxx/Environment/apache-maven-3.6.3</code></p>
<h2 id="2-2-配置环境变量"><a href="#2-2-配置环境变量" class="headerlink" title="2.2 配置环境变量"></a>2.2 配置环境变量</h2><p>打开terminel输入以下命令： <code>vim ~/.bash_profile</code> 打开<code>.bash_profile</code>文件，在此文件中添加设置环境变量的命令</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">export M2_HOME&#x3D;&quot;&#x2F;Users&#x2F;v0w&#x2F;Environment&#x2F;apache-maven-3.6.3&quot;</span><br><span class="line">export PATH&#x3D;$PATH:$M2_HOME&#x2F;bin</span><br></pre></td></tr></table></figure>
<p>添加之后保存并，执行以下命令使配置生效：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">source ~&#x2F;.bash_profile</span><br></pre></td></tr></table></figure>
<p>查看配置是否生效<code>mvn -v</code></p>
<h2 id="2-3-配置阿里云镜像"><a href="#2-3-配置阿里云镜像" class="headerlink" title="2.3 配置阿里云镜像"></a>2.3 配置阿里云镜像</h2><p>国内最好的maven repository<br>第一步:修改maven根目录下的conf文件夹中的setting.xml文件，内容如下：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mirrors</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mirror</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span>&gt;</span>alimaven<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">name</span>&gt;</span>aliyun maven<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://maven.aliyun.com/nexus/content/groups/public/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">mirrorOf</span>&gt;</span>central<span class="tag">&lt;/<span class="name">mirrorOf</span>&gt;</span>        </span><br><span class="line">    <span class="tag">&lt;/<span class="name">mirror</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">mirrors</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>第二步: pom.xml文件里添加</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">repositories</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">repository</span>&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>alimaven<span class="tag">&lt;/<span class="name">id</span>&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;<span class="name">name</span>&gt;</span>aliyun maven<span class="tag">&lt;/<span class="name">name</span>&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://maven.aliyun.com/nexus/content/groups/public/<span class="tag">&lt;/<span class="name">url</span>&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;<span class="name">releases</span>&gt;</span>  </span><br><span class="line">                <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;/<span class="name">releases</span>&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;<span class="name">snapshots</span>&gt;</span>  </span><br><span class="line">                <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>false<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;/<span class="name">snapshots</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;/<span class="name">repository</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">repositories</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>建立本地仓库</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">localRepository</span>&gt;</span>/Users/v0w/Environment/apache-maven-3.6.3/maven-repo<span class="tag">&lt;/<span class="name">localRepository</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="2-4-IDEA下使用Maven"><a href="#2-4-IDEA下使用Maven" class="headerlink" title="2.4 IDEA下使用Maven"></a>2.4 IDEA下使用Maven</h2><p><img src="https://image.v0w.top/2020/12/16079443404504.jpg" alt="新建Maven"></p>
<p>在IDEA中的配置：<br><img src="https://image.v0w.top/2020/12/16079490698552.jpg" alt="Maven配置"></p>
<p>使用<code>archtype</code>时，创建的<code>webapp maven</code>项目：<br><img src="https://image.v0w.top/2020/12/16079494270820.jpg" alt="webapp Maven"></p>
<p>不使用<code>archtype</code>时，创建的默认的maven项目：<br><img src="https://image.v0w.top/2020/12/16079492213801.jpg" alt="默认maven"></p>
<h2 id="2-5-IDEA-配置tomcat"><a href="#2-5-IDEA-配置tomcat" class="headerlink" title="2.5 IDEA 配置tomcat"></a>2.5 IDEA 配置tomcat</h2><p><img src="https://image.v0w.top/2020/12/16079983699922.jpg" alt="add configuration"></p>
<p><img src="https://image.v0w.top/2020/12/16079988426282.jpg" alt="tomcat详细配置"></p>
<p><strong>为什么会有这个问题：我们访问一个网站需要指定一个文件夹名称</strong></p>
<p>解决警告问题。<br><img src="https://image.v0w.top/2020/12/16079989885435.jpg" alt="解决警告问题"></p>
<p>tomcat虚拟访问路径的配置<br><img src="https://image.v0w.top/2020/12/16079992796791.jpg"></p>
<h2 id="2-6-pom-xml文件"><a href="#2-6-pom-xml文件" class="headerlink" title="2.6 pom.xml文件"></a>2.6 pom.xml文件</h2><p>pom.xml是maven的核心配置文件：<br>pom.xml文件结构和各部分功能如下：<br><img src="https://image.v0w.top/2020/12/16080025480781.jpg" alt="pom.xml文件结构"></p>
<p>对于dependency，可以体现maven的高级之处：不仅会导入dependecy中明确配置的jar包，还会自动导入其依赖的其他jar包。</p>
<p>maven由于<strong>约定大于配置</strong>的性质，之后我们写的配置文件可能存在无法导出或者无法生效的问题。</p>
<p>解决方案：<br>配置resources，防止资源导出失败问题：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--在build中配置resources，防止资源导出失败问题--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/resources<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">includes</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.properties<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.xml<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">includes</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">filtering</span>&gt;</span>true<span class="tag">&lt;/<span class="name">filtering</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/java<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">includes</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.properties<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.xml<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">includes</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">filtering</span>&gt;</span>true<span class="tag">&lt;/<span class="name">filtering</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="0x03-Servlet"><a href="#0x03-Servlet" class="headerlink" title="0x03 Servlet"></a>0x03 Servlet</h1><h2 id="3-1-Servlet-简介"><a href="#3-1-Servlet-简介" class="headerlink" title="3.1 Servlet 简介"></a>3.1 Servlet 简介</h2><ul>
<li>Servlet是sun公司开发动态web的技术</li>
<li>Servlet是一个接口，想开发一个动态web程序，分为两步：<ol>
<li>编写一个java类，实现Servlet接口</li>
<li>将编写好的java程序部署到tomcat服务器中</li>
</ol>
</li>
</ul>
<p><strong>我们把实现了Servlet接口的应用程序成为Servlet</strong><br>Servlet接口有两个默认的实现类：</p>
<ul>
<li>GenericServlet</li>
<li>HttpServlet<br>继承接口如下：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">op1&#x3D;&gt;operation: Servlet接口</span><br><span class="line">op2&#x3D;&gt;operation: GenericServlet类</span><br><span class="line">op3&#x3D;&gt;operation: HttpServlet类</span><br><span class="line">op1-&gt;op2-&gt;op3</span><br></pre></td></tr></table></figure>


<h2 id="3-2-HelloServlet"><a href="#3-2-HelloServlet" class="headerlink" title="3.2 HelloServlet"></a>3.2 HelloServlet</h2><p><strong>1、 新建工程，使用Maven并优化</strong><br>优化Maven：<br>增加目录：resources + java<br>将web.xml修改成最新版的web.xml<br>最新的web.xml</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee</span></span></span><br><span class="line"><span class="tag"><span class="string">                  http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">version</span>=<span class="string">&quot;4.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">metadata-complete</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span> &gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>2、编写Servlet</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> top.v0w.servlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.PrintWriter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line"><span class="comment">//        super.doGet(req, resp);</span></span><br><span class="line">        PrintWriter writer = resp.getWriter();  <span class="comment">// 响应流</span></span><br><span class="line">        writer.println(<span class="string">&quot;Hello, Servlet&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line"><span class="comment">//        super.doPost(req, resp);</span></span><br><span class="line">            doGet(req, resp);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>3、编写映射</strong><br>为什么需要映射：我们写的是java程序，浏览器需要连接web服务器，我们需要在web服务器注册写的servlet，并且给浏览器一个可以访问的路径。</p>
<p>在web.xml中增加servlet的注册和路径映射</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--  注册selevet  --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>hello<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>top.v0w.servlet.HelloServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--  servlet路径映射  --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>hello<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/hello<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>4、访问测试</strong><br><img src="https://image.v0w.top/2020/12/16080063630398.jpg" alt="测试成功"></p>
<h2 id="3-3-Servlet原理"><a href="#3-3-Servlet原理" class="headerlink" title="3.3 Servlet原理"></a>3.3 Servlet原理</h2><p><img src="https://image.v0w.top/2020/12/16080069532323.jpg" alt="Servlet运行流程"></p>
<h2 id="3-4-Mapping问题"><a href="#3-4-Mapping问题" class="headerlink" title="3.4 Mapping问题"></a>3.4 Mapping问题</h2><ul>
<li>一个Servlet可以映射多个路径</li>
<li>可以使用通配符进行映射<code>&lt;url-pattern&gt;/hello/*&lt;/url-pattern&gt;</code></li>
<li>可以自定义后缀</li>
</ul>
<h2 id="3-5-ServletContext"><a href="#3-5-ServletContext" class="headerlink" title="3.5 ServletContext"></a>3.5 ServletContext</h2><p>web容器在启动的时候，会为每个Servlet创建一个ServletContext对象，它代表当前的web应用。</p>
<ul>
<li>共享数据：多个Servlet之间进行通信等</li>
<li>请求转发</li>
<li>获取初始化参数</li>
<li>读取配置文件</li>
</ul>
<p>这里补充一下请求转发和重定向的区别：<br><img src="https://image.v0w.top/2020/12/16087067508081.jpg" alt="请求转发和重定向"></p>
<h2 id="3-6-HttpServletRequest"><a href="#3-6-HttpServletRequest" class="headerlink" title="3.6 HttpServletRequest"></a>3.6 HttpServletRequest</h2><ul>
<li>获取前端传递的参数</li>
<li>请求转发</li>
</ul>
<h3 id="3-6-1-获取请求参数"><a href="#3-6-1-获取请求参数" class="headerlink" title="3.6.1 获取请求参数"></a>3.6.1 获取请求参数</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">req.getParameter(<span class="string">&quot;username&quot;</span>);</span><br><span class="line">req.getParameterValues(<span class="string">&quot;hobbies&quot;</span>);</span><br></pre></td></tr></table></figure>
<h3 id="3-6-2-请求转发"><a href="#3-6-2-请求转发" class="headerlink" title="3.6.2 请求转发"></a>3.6.2 请求转发</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">req.getRequestDispatcher(<span class="string">&quot;/sucess.jsp&quot;</span>).forward(req,resp);</span><br></pre></td></tr></table></figure>

<h2 id="3-7-HttpServletResponse"><a href="#3-7-HttpServletResponse" class="headerlink" title="3.7 HttpServletResponse"></a>3.7 HttpServletResponse</h2><p>应用：</p>
<ul>
<li>向浏览器输出信息</li>
<li>下载文件</li>
<li>生成验证码</li>
<li>实现重定向</li>
</ul>
<h3 id="3-7-1-下载文件"><a href="#3-7-1-下载文件" class="headerlink" title="3.7.1 下载文件"></a>3.7.1 下载文件</h3><p>编写Servlet</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> top.v0w.servlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletOutputStream;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.net.URLEncoder;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DownloadServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line"><span class="comment">//1. 获取文件的下载路径</span></span><br><span class="line">        String realPath = <span class="string">&quot;/Users/v0w/Desktop/test.jpg&quot;</span>;</span><br><span class="line">        System.out.println(<span class="string">&quot;path: &quot;</span>+realPath);</span><br><span class="line"><span class="comment">//2. 下载文件的文件名</span></span><br><span class="line">        String filename = realPath.substring(realPath.lastIndexOf(<span class="string">&quot;/&quot;</span>)+<span class="number">1</span>);</span><br><span class="line"><span class="comment">//3. setHeaders是浏览器支持下载的数据类型</span></span><br><span class="line">        resp.setHeader(<span class="string">&quot;Content-Disposition&quot;</span>, <span class="string">&quot;attachment;filename=&quot;</span>+ URLEncoder.encode(filename, <span class="string">&quot;utf-8&quot;</span>));</span><br><span class="line"><span class="comment">//4. 获取下载文件的输入流</span></span><br><span class="line">        FileInputStream in = <span class="keyword">new</span> FileInputStream(realPath);</span><br><span class="line"><span class="comment">//5. 获取缓冲区</span></span><br><span class="line">        <span class="keyword">int</span> len = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">byte</span>[] buffer = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>];</span><br><span class="line"><span class="comment">//6. OutputStream</span></span><br><span class="line">        ServletOutputStream out = resp.getOutputStream();</span><br><span class="line"><span class="comment">//7. FileInputStream into buffer, buffer into client through ServletOutputStream</span></span><br><span class="line">        <span class="keyword">while</span> ((len = in.read(buffer))&gt;<span class="number">0</span>)&#123;</span><br><span class="line">            out.write(buffer,<span class="number">0</span>, len);</span><br><span class="line">        &#125;</span><br><span class="line">        in.close();</span><br><span class="line">        out.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注册Servlet</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>download<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>top.v0w.servlet.DownloadServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>download<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/down<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="3-7-2-验证码"><a href="#3-7-2-验证码" class="headerlink" title="3.7.2 验证码"></a>3.7.2 验证码</h3><p>验证码Servlet</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> top.v0w.servlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.imageio.ImageIO;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.awt.*;</span><br><span class="line"><span class="keyword">import</span> java.awt.image.BufferedImage;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ImageServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        <span class="comment">// 浏览器自动刷新</span></span><br><span class="line">        resp.setHeader(<span class="string">&quot;refresh&quot;</span>,<span class="string">&quot;3&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//内存中创建一个图片</span></span><br><span class="line">        BufferedImage image = <span class="keyword">new</span> BufferedImage(<span class="number">80</span>, <span class="number">20</span>, BufferedImage.TYPE_INT_RGB);</span><br><span class="line">        <span class="comment">// 得到图片</span></span><br><span class="line">        Graphics2D g = (Graphics2D) image.getGraphics();    <span class="comment">//类似画笔</span></span><br><span class="line">        <span class="comment">// 设置图片背景颜色</span></span><br><span class="line">        g.setBackground(Color.white);</span><br><span class="line">        g.fillRect(<span class="number">0</span>,<span class="number">0</span>,<span class="number">80</span>,<span class="number">20</span>);</span><br><span class="line">        <span class="comment">// 给图片写数据</span></span><br><span class="line">        g.setColor(Color.blue);</span><br><span class="line">        g.setFont(<span class="keyword">new</span> Font(<span class="string">&quot;aa&quot;</span>,Font.BOLD,<span class="number">20</span>));</span><br><span class="line">        g.drawString(makeRandom(),<span class="number">0</span>,<span class="number">20</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//告诉浏览器格式，如何打开</span></span><br><span class="line">        resp.setContentType(<span class="string">&quot;image/jpg&quot;</span>);</span><br><span class="line">        resp.setDateHeader(<span class="string">&quot;expires&quot;</span>,-<span class="number">1</span>);</span><br><span class="line">        resp.setHeader(<span class="string">&quot;Cache-Control&quot;</span>,<span class="string">&quot;no-cache&quot;</span>);</span><br><span class="line">        resp.setHeader(<span class="string">&quot;Pragma&quot;</span>,<span class="string">&quot;no-cache&quot;</span>);</span><br><span class="line"></span><br><span class="line">        ImageIO.write(image,<span class="string">&quot;jpg&quot;</span>,resp.getOutputStream());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> String <span class="title">makeRandom</span><span class="params">()</span></span>&#123;</span><br><span class="line">        Random random = <span class="keyword">new</span> Random();</span><br><span class="line">        String num =  random.nextInt(<span class="number">999999</span>)+<span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="comment">//处理009999这种情况</span></span><br><span class="line">        StringBuffer sb = <span class="keyword">new</span> StringBuffer();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">6</span>-num.length(); i++) &#123;</span><br><span class="line">            sb.append(<span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        sb.append(num);</span><br><span class="line">        <span class="keyword">return</span> sb.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注册Servlet</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>img<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>top.v0w.servlet.ImageServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>img<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/img<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="https://image.v0w.top/2020/12/16087061198418.jpg" alt="结果真不戳"></p>
<h3 id="3-7-3-实现重定向"><a href="#3-7-3-实现重定向" class="headerlink" title="3.7.3 实现重定向"></a>3.7.3 实现重定向</h3><p>常见场景：用户登录等</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">sendRedirect</span><span class="params">(String var1)</span> <span class="keyword">throws</span> IOException</span>;</span><br></pre></td></tr></table></figure>

<h2 id="3-8-Cookie"><a href="#3-8-Cookie" class="headerlink" title="3.8 Cookie"></a>3.8 Cookie</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> top.v0w.servlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.Cookie;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.PrintWriter;</span><br><span class="line"><span class="keyword">import</span> java.text.DateFormat;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CookieServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        resp.setCharacterEncoding(<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">        req.setCharacterEncoding(<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line"></span><br><span class="line">        PrintWriter pw = resp.getWriter();</span><br><span class="line">        Cookie[] cookies = req.getCookies();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (Cookie cookie : cookies) &#123;</span><br><span class="line">            <span class="keyword">if</span>(cookie.getName().equals(<span class="string">&quot;time&quot;</span>))&#123;</span><br><span class="line">                <span class="keyword">long</span> time = Long.parseLong(cookie.getValue());</span><br><span class="line">                Date datetime = <span class="keyword">new</span> Date(time);</span><br><span class="line">                pw.write(datetime.toString());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Cookie c = <span class="keyword">new</span> Cookie(<span class="string">&quot;time&quot;</span>,System.currentTimeMillis()+<span class="string">&quot;&quot;</span>);</span><br><span class="line">        resp.addCookie(c);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://image.v0w.top/2020/12/16087171782400.jpg" alt="Cookie"></p>
<h2 id="3-9-Session"><a href="#3-9-Session" class="headerlink" title="3.9 Session"></a>3.9 Session</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> top.v0w.servlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.*;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.PrintWriter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SessionServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        req.setCharacterEncoding(<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">        resp.setCharacterEncoding(<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">        resp.setContentType(<span class="string">&quot;text/html;charset=utf-8&quot;</span>);</span><br><span class="line">        PrintWriter pw = resp.getWriter();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//getSession</span></span><br><span class="line">        HttpSession session = req.getSession();</span><br><span class="line">        session.setAttribute(<span class="string">&quot;name&quot;</span>,<span class="string">&quot;V0W&quot;</span>);</span><br><span class="line"></span><br><span class="line">        String SessionId = session.getId();</span><br><span class="line">        <span class="keyword">if</span>(session.isNew())&#123;</span><br><span class="line">            pw.write(<span class="string">&quot;u are new one, id is &quot;</span>+SessionId);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            pw.write(<span class="string">&quot;old one, id is &quot;</span>+SessionId);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        String name = (String) session.getAttribute(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">        pw.write(<span class="string">&quot;name: &quot;</span>+name);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">/* Session做了什么事情：</span></span><br><span class="line"><span class="comment">        * Cookie jsessionid = new Cookie(&quot;JSESSIONID&quot;, SessionId);</span></span><br><span class="line"><span class="comment">        * resp.addCookie(jsessionid)</span></span><br><span class="line"><span class="comment">        * */</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://image.v0w.top/2020/12/16087162567456.jpg" alt="JSESSIONID"></p>
<p>Session失效：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">session.invalidate();</span><br></pre></td></tr></table></figure>

<p>可以在web程序的web.xml中设置session时间等配置，也可以在Tomcat等容器的web.xml中设置session时间。</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- session-config包含一个子元素session-timeout.定义web站台中的session参数.  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">session-config</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 定义这个web站台所有session的有效期限.单位为分钟. 例子中为600分钟 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">session-timeout</span>&gt;</span>600<span class="tag">&lt;/<span class="name">session-timeout</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">session-config</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>优先级：Servlet中API设置 &gt; 程序/web.xml设置 &gt; Tomcat/conf/web.xml设置</strong></p>
<h1 id="0x04-JSP"><a href="#0x04-JSP" class="headerlink" title="0x04 JSP"></a>0x04 JSP</h1><h2 id="4-1-JSP原理"><a href="#4-1-JSP原理" class="headerlink" title="4.1 JSP原理"></a>4.1 JSP原理</h2><p>Java Server Page: 可以嵌入Java代码，实现动态功能。</p>
<p>服务器会把jsp编译成java代码和class, jsp本质上就是servlet。<br><img src="https://image.v0w.top/2020/12/16087856535381.jpg"></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 初始化</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">_jspInit</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="comment">// 销毁</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">_jspDestroy</span><span class="params">()</span> </span></span><br><span class="line"><span class="function"><span class="comment">// jspService</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">_jspService</span><span class="params">(<span class="keyword">final</span> javax.servlet.http.HttpServletRequest request, <span class="keyword">final</span> javax.servlet.http.HttpServletResponse response)</span></span></span><br></pre></td></tr></table></figure>
<ol>
<li><p>判断请求类型</p>
</li>
<li><p>内置一些对象</p>
 <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">final</span> javax.servlet.jsp.PageContext pageContext;<span class="comment">//页面上下文</span></span><br><span class="line"><span class="keyword">final</span> javax.servlet.ServletContext application;<span class="comment">//applicationContext</span></span><br><span class="line"><span class="keyword">final</span> javax.servlet.ServletConfig config;<span class="comment">//config</span></span><br><span class="line">javax.servlet.jsp.JspWriter out = <span class="keyword">null</span>;<span class="comment">//out</span></span><br><span class="line"><span class="keyword">final</span> java.lang.Object page = <span class="keyword">this</span>;<span class="comment">//page this</span></span><br><span class="line">javax.servlet.jsp.JspWriter _jspx_out = <span class="keyword">null</span>;<span class="comment">//out</span></span><br><span class="line">javax.servlet.jsp.PageContext _jspx_page_context = <span class="keyword">null</span>;<span class="comment">//页面上下文</span></span><br></pre></td></tr></table></figure></li>
<li><p>输出页面增加的代码</p>
 <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">      response.setContentType(<span class="string">&quot;text/html; charset=UTF-8&quot;</span>);</span><br><span class="line">      pageContext = _jspxFactory.getPageContext(<span class="keyword">this</span>, request, response,</span><br><span class="line">      			<span class="keyword">null</span>, <span class="keyword">false</span>, <span class="number">8192</span>, <span class="keyword">true</span>);</span><br><span class="line">      _jspx_page_context = pageContext;</span><br><span class="line">      application = pageContext.getServletContext();</span><br><span class="line">      config = pageContext.getServletConfig();</span><br><span class="line">      out = pageContext.getOut();</span><br><span class="line">      _jspx_out = out;</span><br></pre></td></tr></table></figure></li>
<li><p>以上对象可以在JSP直接使用</p>
</li>
</ol>
<p><img src="https://image.v0w.top/2020/12/16087880765117.jpg" alt="jsp流程图"></p>
<h2 id="4-2-JSP语法"><a href="#4-2-JSP语法" class="headerlink" title="4.2 JSP语法"></a>4.2 JSP语法</h2><figure class="highlight jsp"><table><tr><td class="code"><pre><span class="line">&lt;%--jsp表达式：</span><br><span class="line">&lt;%= 变量或者表达式%&gt;</span><br><span class="line">--%&gt;</span><br><span class="line">&lt;%= <span class="keyword">new</span> java.util.Date()%&gt;</span><br><span class="line"></span><br><span class="line">&lt;%-- &lt;% Java代码 %&gt; --%&gt;</span><br><span class="line">&lt;%</span><br><span class="line">    <span class="keyword">int</span> sum=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">50</span>; i++) &#123;</span><br><span class="line">        sum+=i;</span><br><span class="line">    &#125;</span><br><span class="line">    out.write(<span class="string">&quot;&lt;h1&gt;&quot;</span>+sum+<span class="string">&quot;&lt;/h1&gt;&quot;</span>);</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure>
<p>jsp声明</p>
<figure class="highlight jsp"><table><tr><td class="code"><pre><span class="line">&lt;%!</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> globalVar = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">static</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;Loading&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure>
<p>jsp声明生成java代码放到<code>index_jsp.java</code>类里面，jsp表达式等生成java代码放到<code>_jspService</code>方法中。</p>
<h2 id="4-3-JSP指令"><a href="#4-3-JSP指令" class="headerlink" title="4.3 JSP指令"></a>4.3 JSP指令</h2><figure class="highlight jsp"><table><tr><td class="code"><pre><span class="line">&lt;%<span class="meta">@page</span> errorPage=<span class="string">&quot;error.jsp&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> %&gt;</span><br></pre></td></tr></table></figure>

<h2 id="4-4-九大内置对象"><a href="#4-4-九大内置对象" class="headerlink" title="4.4 九大内置对象"></a>4.4 九大内置对象</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1. PageContext</span><br><span class="line">2. Request</span><br><span class="line">3. Response</span><br><span class="line">4. Session</span><br><span class="line">5. Application（ServletContext）</span><br><span class="line">6. config (ServletConfig)</span><br><span class="line">7. out</span><br><span class="line">8. page</span><br><span class="line">9. exception</span><br></pre></td></tr></table></figure>

<p>举例</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;Title&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;%</span><br><span class="line">    pageContext.setAttribute(<span class="string">&quot;name1&quot;</span>,<span class="string">&quot;V0W1&quot;</span>);</span><br><span class="line">    request.setAttribute(<span class="string">&quot;name2&quot;</span>,<span class="string">&quot;v0w2&quot;</span>);</span><br><span class="line">    session.setAttribute(<span class="string">&quot;name3&quot;</span>,<span class="string">&quot;V0W3&quot;</span>);</span><br><span class="line">    application.setAttribute(<span class="string">&quot;name4&quot;</span>,<span class="string">&quot;V0W4&quot;</span>);</span><br><span class="line">%&gt;</span><br><span class="line"></span><br><span class="line">&lt;%</span><br><span class="line">    String name1 = (String) pageContext.findAttribute(<span class="string">&quot;name1&quot;</span>);</span><br><span class="line">    String name2 = (String) pageContext.findAttribute(<span class="string">&quot;name2&quot;</span>);</span><br><span class="line">    String name3 = (String) pageContext.findAttribute(<span class="string">&quot;name3&quot;</span>);</span><br><span class="line">    String name4 = (String) pageContext.findAttribute(<span class="string">&quot;name4&quot;</span>);</span><br><span class="line">    String name5 = (String) pageContext.findAttribute(<span class="string">&quot;name5&quot;</span>);</span><br><span class="line">%&gt;</span><br><span class="line"></span><br><span class="line">&lt;%--使用EL表达式来取最快 $&#123;&#125; 且对于不存在的变量，不会显示--%&gt;</span><br><span class="line">&lt;h2&gt;取出的值为&lt;/h2&gt;</span><br><span class="line">&lt;h3&gt;$&#123;name1&#125;&lt;/h3&gt;</span><br><span class="line">&lt;h3&gt;$&#123;name2&#125;&lt;/h3&gt;</span><br><span class="line">&lt;h3&gt;$&#123;name3&#125;&lt;/h3&gt;</span><br><span class="line">&lt;h3&gt;$&#123;name4&#125;&lt;/h3&gt;</span><br><span class="line">&lt;h3&gt;$&#123;name5&#125;&lt;/h3&gt;</span><br><span class="line"></span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<h2 id="4-5-jsp标签-amp-JSTL表达式-amp-EL表达式"><a href="#4-5-jsp标签-amp-JSTL表达式-amp-EL表达式" class="headerlink" title="4.5 jsp标签&amp;JSTL表达式&amp;EL表达式"></a>4.5 jsp标签&amp;JSTL表达式&amp;EL表达式</h2><p>依赖</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/javax.servlet.jsp/javax.servlet.jsp-api --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet.jsp<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javax.servlet.jsp-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- https://mvnrepository.com/artifact/javax.servlet.jsp.jstl/jstl --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet.jsp.jstl<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jstl<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- https://mvnrepository.com/artifact/taglibs/standard --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>taglibs<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>standard<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="jsp标签"><a href="#jsp标签" class="headerlink" title="jsp标签"></a>jsp标签</h3><figure class="highlight jsp"><table><tr><td class="code"><pre><span class="line">&lt;%--包含文件--%&gt;</span><br><span class="line">&lt;jsp:include page=&quot;index.jsp&quot;&gt;&lt;/jsp:include&gt;</span><br><span class="line"></span><br><span class="line">&lt;jsp:forward page=<span class="string">&quot;index.jsp&quot;</span>&gt;</span><br><span class="line">    &lt;jsp:param name=<span class="string">&quot;name&quot;</span> value=<span class="string">&quot;V0W&quot;</span>/&gt;</span><br><span class="line">    &lt;jsp:param name=<span class="string">&quot;age&quot;</span> value=<span class="string">&quot;12&quot;</span>/&gt;</span><br><span class="line">&lt;/jsp:forward&gt;</span><br><span class="line">&lt;%--相当于index.jsp?name=V0W&amp;age=<span class="number">12</span>--%&gt;</span><br></pre></td></tr></table></figure>

<h3 id="JSTL标签"><a href="#JSTL标签" class="headerlink" title="JSTL标签"></a>JSTL标签</h3><p>JSTL标签库的使用就是为了弥补jsp标签的不足。<br>需要依赖一些jar包：<br>1：jstl-1.2<br>2：standard-1.1.2<br>3：jstl-api-1.2.1<br>4：jstl-impl-1.2</p>
<p>pom.xml</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/javax.servlet.jsp.jstl/jstl --&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet.jsp.jstl<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jstl<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"> <span class="comment">&lt;!-- https://mvnrepository.com/artifact/taglibs/standard --&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>taglibs<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>standard<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"> <span class="comment">&lt;!-- https://mvnrepository.com/artifact/javax.servlet.jsp.jstl/jstl-api --&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet.jsp.jstl<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jstl-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"> <span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.glassfish.web/jstl-impl --&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.glassfish.web<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jstl-impl<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>引入JSTL标签</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;%--核心标签是最常用的 JSTL标签。引用核心标签库的语法如下：--%&gt;</span><br><span class="line">&lt;%@ taglib prefix&#x3D;&quot;c&quot; uri&#x3D;&quot;http:&#x2F;&#x2F;java.sun.com&#x2F;jsp&#x2F;jstl&#x2F;core&quot; %&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight jsp"><table><tr><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> %&gt;</span><br><span class="line"></span><br><span class="line">&lt;%--核心标签是最常用的 JSTL标签。引用核心标签库的语法如下：--%&gt;</span><br><span class="line">&lt;%@ taglib prefix=<span class="string">&quot;c&quot;</span> uri=<span class="string">&quot;http://java.sun.com/jsp/jstl/core&quot;</span> %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;JSTL&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"></span><br><span class="line">&lt;hr&gt;</span><br><span class="line">&lt;form action=<span class="string">&quot;JSTL.jsp&quot;</span> method=<span class="string">&quot;get&quot;</span>&gt;</span><br><span class="line">    &lt;%--</span><br><span class="line">    EL 表达式获取表单的数据</span><br><span class="line">    $&#123;param.username&#125;</span><br><span class="line">    --%&gt;</span><br><span class="line">    &lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;username&quot;</span> value=<span class="string">&quot;$&#123;param.username&#125;&quot;</span>&gt;</span><br><span class="line">    &lt;input type=<span class="string">&quot;submit&quot;</span> value=<span class="string">&quot;提交&quot;</span>&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line"></span><br><span class="line">&lt;%--判断提交的用户名是admin，就登录成功--%&gt;</span><br><span class="line">&lt;c:<span class="keyword">if</span> test=<span class="string">&quot;$&#123;param.username==&#x27;admin&#x27;&#125;&quot;</span> <span class="keyword">var</span>=<span class="string">&quot;isAdmin&quot;</span>&gt;</span><br><span class="line">    &lt;c:out value=<span class="string">&quot;管理员欢迎你&quot;</span> /&gt;</span><br><span class="line">&lt;/c:if&gt;</span><br><span class="line"></span><br><span class="line">&lt;c:out value=<span class="string">&quot;$&#123;isAdmin&#125;&quot;</span> /&gt;</span><br><span class="line"></span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><img src="https://image.v0w.top/2020/12/16091261714129.jpg" alt="效果图"><br>其他标签需要的时候，参考<a target="_blank" rel="noopener" href="https://www.runoob.com/jsp/jsp-jstl.html">菜鸟教程-jsp-jstl标签</a>即可</p>
<h3 id="EL表达式"><a href="#EL表达式" class="headerlink" title="EL表达式"></a>EL表达式</h3><p>不同版本的tomcat是否默认开启对EL表达式的支持，是不一定的。<br>所以为了保证EL表达式能够正常使用，需要在<code>&lt;%@page</code>标签里加上<code>isELIgnored=&quot;false&quot;</code><br>使用EL表达式，非常简单。</p>
<p><strong>输出</strong><br>比如使用JSTL输出要写成</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;c:out value&#x3D;&quot;$&#123;name&#125;&quot; &#x2F;&gt; </span><br></pre></td></tr></table></figure>
<p>但是用EL只需要</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$&#123;name&#125;</span><br></pre></td></tr></table></figure>

<p>EL表达式可以从<code>pageContext,request,session,application</code>四个作用域中取到值，如果4个作用域都有name属性怎么办？<br>EL会按照从高到低的优先级顺序获取<br><code>pageContext&gt;request&gt;session&gt;application</code></p>
<figure class="highlight jsp"><table><tr><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">&quot;java&quot;</span> contentType=<span class="string">&quot;text/html; charset=UTF-8&quot;</span></span><br><span class="line">    pageEncoding=<span class="string">&quot;UTF-8&quot;</span> isELIgnored=<span class="string">&quot;false&quot;</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;%@ taglib uri=<span class="string">&quot;http://java.sun.com/jsp/jstl/core&quot;</span> prefix=<span class="string">&quot;c&quot;</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;c:set <span class="keyword">var</span>=<span class="string">&quot;name&quot;</span> value=<span class="string">&quot;$&#123;&#x27;gareen-pageContext&#x27;&#125;&quot;</span> scope=<span class="string">&quot;page&quot;</span> /&gt;</span><br><span class="line">&lt;c:set <span class="keyword">var</span>=<span class="string">&quot;name&quot;</span> value=<span class="string">&quot;$&#123;&#x27;gareen-request&#x27;&#125;&quot;</span> scope=<span class="string">&quot;request&quot;</span> /&gt;</span><br><span class="line">&lt;c:set <span class="keyword">var</span>=<span class="string">&quot;name&quot;</span> value=<span class="string">&quot;$&#123;&#x27;gareen-session&#x27;&#125;&quot;</span> scope=<span class="string">&quot;session&quot;</span> /&gt;</span><br><span class="line">&lt;c:set <span class="keyword">var</span>=<span class="string">&quot;name&quot;</span> value=<span class="string">&quot;$&#123;&#x27;gareen-application&#x27;&#125;&quot;</span> scope=<span class="string">&quot;application&quot;</span> /&gt;</span><br><span class="line"> </span><br><span class="line"><span class="number">4</span>个作用域都有name,优先获取出来的是 ： $&#123;name&#125;</span><br></pre></td></tr></table></figure>

<p>结合JSTL标签<code>&lt;c:forEach&gt;</code>使用，可以进一步简化代码：</p>
<figure class="highlight jsp"><table><tr><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">&quot;java&quot;</span> contentType=<span class="string">&quot;text/html; charset=UTF-8&quot;</span></span><br><span class="line">    pageEncoding=<span class="string">&quot;UTF-8&quot;</span> <span class="keyword">import</span>=<span class="string">&quot;java.util.*&quot;</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;%@ taglib uri=<span class="string">&quot;http://java.sun.com/jsp/jstl/core&quot;</span> prefix=<span class="string">&quot;c&quot;</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;%</span><br><span class="line">    List&lt;String&gt; heros = <span class="keyword">new</span> ArrayList&lt;String&gt;();</span><br><span class="line">    heros.add(<span class="string">&quot;塔姆&quot;</span>);</span><br><span class="line">    heros.add(<span class="string">&quot;艾克&quot;</span>);</span><br><span class="line">    heros.add(<span class="string">&quot;巴德&quot;</span>);</span><br><span class="line">    heros.add(<span class="string">&quot;雷克赛&quot;</span>);</span><br><span class="line">    heros.add(<span class="string">&quot;卡莉丝塔&quot;</span>);</span><br><span class="line">    request.setAttribute(<span class="string">&quot;heros&quot;</span>,heros);</span><br><span class="line">%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;table width=<span class="string">&quot;200px&quot;</span> align=<span class="string">&quot;center&quot;</span> border=<span class="string">&quot;1&quot;</span> cellspacing=<span class="string">&quot;0&quot;</span>&gt;</span><br><span class="line">&lt;tr&gt;</span><br><span class="line">    &lt;td&gt;编号&lt;/td&gt;</span><br><span class="line">    &lt;td&gt;英雄&lt;/td&gt;</span><br><span class="line">&lt;/tr&gt;</span><br><span class="line">   </span><br><span class="line">&lt;c:forEach items=<span class="string">&quot;$&#123;heros&#125;&quot;</span> <span class="keyword">var</span>=<span class="string">&quot;hero&quot;</span> varStatus=<span class="string">&quot;st&quot;</span>  &gt;</span><br><span class="line">    &lt;tr&gt;</span><br><span class="line">        &lt;td&gt;$&#123;st.count&#125;&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;$&#123;hero&#125;&lt;/td&gt;</span><br><span class="line">    &lt;/tr&gt;</span><br><span class="line">&lt;/c:forEach&gt;</span><br><span class="line">&lt;/table&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>取参数</strong></p>
<figure class="highlight jsp"><table><tr><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">&quot;java&quot;</span> contentType=<span class="string">&quot;text/html; charset=UTF-8&quot;</span></span><br><span class="line">    pageEncoding=<span class="string">&quot;UTF-8&quot;</span> <span class="keyword">import</span>=<span class="string">&quot;java.util.*&quot;</span> isELIgnored=<span class="string">&quot;false&quot;</span>%&gt;</span><br><span class="line"> </span><br><span class="line">$&#123;param.name&#125;</span><br></pre></td></tr></table></figure>

<h1 id="0x05-MVC框架"><a href="#0x05-MVC框架" class="headerlink" title="0x05 MVC框架"></a>0x05 MVC框架</h1><p><img src="https://image.v0w.top/2020/12/16091321478240.jpg" alt="早期架构"><br>仅仅使用Servlet缺点：</p>
<ul>
<li>Servlet不仅要准备数据，还要准备html。 尤其是准备html，可读性非常差，维护起来也很麻烦</li>
</ul>
<p>仅仅使用jsp缺点：</p>
<ul>
<li>虽然编写html方便了，但是写java代码不如在Servlet中那么方便</li>
</ul>
<p>结合Serlvet和JSP进行数据的显示，就是一种MVC的思想。</p>
<ul>
<li>M 代表 模型（Model）</li>
<li>V 代表 视图（View）</li>
<li>C 代表 控制器（controller)</li>
</ul>
<p>模型是什么呢？ 模型就是数据，就是dao,bean<br>视图是什么呢？ 就是网页, JSP，用来展示模型中的数据<br>控制器是什么？ 控制器用来把不同的数据，显示在不同的视图上。 在这个例子的，Servlet就是充当控制器的角色，把Hero对象，显示在JSP上。</p>
<p>控制器的作用就是把不同的数据(Model)，显示在不同的视图(View)上。</p>
<ul>
<li>Model<ul>
<li>业务逻辑层（Service）</li>
<li>数据持久层CRUD(DAO）</li>
</ul>
</li>
<li>View<ul>
<li>显示数据</li>
<li>提供链接，发起Servlet请求</li>
</ul>
</li>
<li>Controller<ul>
<li>接受用户请求（req用户请求，Session信息…）</li>
<li>交给业务层处理对应的代码</li>
<li>控制试图的跳转</li>
</ul>
</li>
</ul>
<p><img src="https://image.v0w.top/2020/12/16091323691808.jpg" alt="MVC框架"></p>
<p>实现一个CRUD操作数据库Hero的小项目：<br>文件结构：<br><img src="https://image.v0w.top/2020/12/16091502187670.jpg" alt="Structure"></p>
<p>bean.Hero</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> top.v0w.bean;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Hero</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">public</span> String name;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">float</span> hp;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> damage;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">float</span> <span class="title">getHp</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> hp;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setHp</span><span class="params">(<span class="keyword">float</span> hp)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.hp = hp;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getDamage</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> damage;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDamage</span><span class="params">(<span class="keyword">int</span> damage)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.damage = damage;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>dao.HeroDAO(也是copy how2j的代码)</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> top.v0w.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"><span class="keyword">import</span> java.sql.DriverManager;</span><br><span class="line"><span class="keyword">import</span> java.sql.PreparedStatement;</span><br><span class="line"><span class="keyword">import</span> java.sql.ResultSet;</span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"><span class="keyword">import</span> java.sql.Statement;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> top.v0w.bean.Hero;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HeroDAO</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">HeroDAO</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Class.forName(<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Connection <span class="title">getConnection</span><span class="params">()</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> DriverManager.getConnection(<span class="string">&quot;jdbc:mysql://127.0.0.1:3306/how2j?characterEncoding=UTF-8&quot;</span>, <span class="string">&quot;root&quot;</span>,</span><br><span class="line">                <span class="string">&quot;V0Wldl.n1ub1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getTotal</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> total = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">try</span> (Connection c = getConnection(); Statement s = c.createStatement();) &#123;</span><br><span class="line"></span><br><span class="line">            String sql = <span class="string">&quot;select count(*) from hero&quot;</span>;</span><br><span class="line"></span><br><span class="line">            ResultSet rs = s.executeQuery(sql);</span><br><span class="line">            <span class="keyword">while</span> (rs.next()) &#123;</span><br><span class="line">                total = rs.getInt(<span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            System.out.println(<span class="string">&quot;total:&quot;</span> + total);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line"></span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> total;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(Hero hero)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        String sql = <span class="string">&quot;insert into hero values(null,?,?,?)&quot;</span>;</span><br><span class="line">        <span class="keyword">try</span> (Connection c = getConnection(); PreparedStatement ps = c.prepareStatement(sql);) &#123;</span><br><span class="line"></span><br><span class="line">            ps.setString(<span class="number">1</span>, hero.name);</span><br><span class="line">            ps.setFloat(<span class="number">2</span>, hero.hp);</span><br><span class="line">            ps.setInt(<span class="number">3</span>, hero.damage);</span><br><span class="line"></span><br><span class="line">            ps.execute();</span><br><span class="line"></span><br><span class="line">            ResultSet rs = ps.getGeneratedKeys();</span><br><span class="line">            <span class="keyword">if</span> (rs.next()) &#123;</span><br><span class="line">                <span class="keyword">int</span> id = rs.getInt(<span class="number">1</span>);</span><br><span class="line">                hero.id = id;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line"></span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(Hero hero)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        String sql = <span class="string">&quot;update hero set name= ?, hp = ? , damage = ? where id = ?&quot;</span>;</span><br><span class="line">        <span class="keyword">try</span> (Connection c = getConnection(); PreparedStatement ps = c.prepareStatement(sql);) &#123;</span><br><span class="line"></span><br><span class="line">            ps.setString(<span class="number">1</span>, hero.name);</span><br><span class="line">            ps.setFloat(<span class="number">2</span>, hero.hp);</span><br><span class="line">            ps.setInt(<span class="number">3</span>, hero.damage);</span><br><span class="line">            ps.setInt(<span class="number">4</span>, hero.id);</span><br><span class="line"></span><br><span class="line">            ps.execute();</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line"></span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delete</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> (Connection c = getConnection(); Statement s = c.createStatement();) &#123;</span><br><span class="line"></span><br><span class="line">            String sql = <span class="string">&quot;delete from hero where id = &quot;</span> + id;</span><br><span class="line"></span><br><span class="line">            s.execute(sql);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line"></span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Hero <span class="title">get</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        Hero hero = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> (Connection c = getConnection(); Statement s = c.createStatement();) &#123;</span><br><span class="line"></span><br><span class="line">            String sql = <span class="string">&quot;select * from hero where id = &quot;</span> + id;</span><br><span class="line"></span><br><span class="line">            ResultSet rs = s.executeQuery(sql);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (rs.next()) &#123;</span><br><span class="line">                hero = <span class="keyword">new</span> Hero();</span><br><span class="line">                String name = rs.getString(<span class="number">2</span>);</span><br><span class="line">                <span class="keyword">float</span> hp = rs.getFloat(<span class="string">&quot;hp&quot;</span>);</span><br><span class="line">                <span class="keyword">int</span> damage = rs.getInt(<span class="number">4</span>);</span><br><span class="line">                hero.name = name;</span><br><span class="line">                hero.hp = hp;</span><br><span class="line">                hero.damage = damage;</span><br><span class="line">                hero.id = id;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line"></span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> hero;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Hero&gt; <span class="title">list</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> list(<span class="number">0</span>, Short.MAX_VALUE);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Hero&gt; <span class="title">list</span><span class="params">(<span class="keyword">int</span> start, <span class="keyword">int</span> count)</span> </span>&#123;</span><br><span class="line">        List&lt;Hero&gt; heros = <span class="keyword">new</span> ArrayList&lt;Hero&gt;();</span><br><span class="line"></span><br><span class="line">        String sql = <span class="string">&quot;select * from hero order by id desc limit ?,? &quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> (Connection c = getConnection(); PreparedStatement ps = c.prepareStatement(sql);) &#123;</span><br><span class="line"></span><br><span class="line">            ps.setInt(<span class="number">1</span>, start);</span><br><span class="line">            ps.setInt(<span class="number">2</span>, count);</span><br><span class="line"></span><br><span class="line">            ResultSet rs = ps.executeQuery();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">while</span> (rs.next()) &#123;</span><br><span class="line">                Hero hero = <span class="keyword">new</span> Hero();</span><br><span class="line">                <span class="keyword">int</span> id = rs.getInt(<span class="number">1</span>);</span><br><span class="line">                String name = rs.getString(<span class="number">2</span>);</span><br><span class="line">                <span class="keyword">float</span> hp = rs.getFloat(<span class="string">&quot;hp&quot;</span>);</span><br><span class="line">                <span class="keyword">int</span> damage = rs.getInt(<span class="number">4</span>);</span><br><span class="line">                hero.id = id;</span><br><span class="line">                hero.name = name;</span><br><span class="line">                hero.hp = hp;</span><br><span class="line">                hero.damage = damage;</span><br><span class="line">                heros.add(hero);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line"></span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> heros;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>filter.CharEncodingFilter</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> top.v0w.filter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.*;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CharEncodingFilter</span> <span class="keyword">implements</span> <span class="title">Filter</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(FilterConfig filterConfig)</span> <span class="keyword">throws</span> ServletException </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;init filter&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(ServletRequest request, ServletResponse response, FilterChain chain)</span> <span class="keyword">throws</span> IOException, ServletException </span>&#123;</span><br><span class="line">        request.setCharacterEncoding(<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">        response.setCharacterEncoding(<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">        response.setContentType(<span class="string">&quot;text/html;charset=UTF-8&quot;</span>);</span><br><span class="line"></span><br><span class="line">        chain.doFilter(request,response);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;destroy filter&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>servlet.ListHeroServlet</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> top.v0w.servlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> top.v0w.bean.Hero;</span><br><span class="line"><span class="keyword">import</span> top.v0w.dao.HeroDAO;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HeroListServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        List&lt;Hero&gt; heros = <span class="keyword">new</span> HeroDAO().list();</span><br><span class="line">        request.setAttribute(<span class="string">&quot;heros&quot;</span>, heros);</span><br><span class="line">        request.getRequestDispatcher(<span class="string">&quot;listHero.jsp&quot;</span>).forward(request, response);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>servlet.DeleteHeroServlet</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> top.v0w.servlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> top.v0w.bean.Hero;</span><br><span class="line"><span class="keyword">import</span> top.v0w.dao.HeroDAO;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HeroListServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        List&lt;Hero&gt; heros = <span class="keyword">new</span> HeroDAO().list();</span><br><span class="line">        request.setAttribute(<span class="string">&quot;heros&quot;</span>, heros);</span><br><span class="line">        request.getRequestDispatcher(<span class="string">&quot;listHero.jsp&quot;</span>).forward(request, response);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>webapp/listHero.jsp</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">&quot;java&quot;</span> contentType=<span class="string">&quot;text/html; charset=UTF-8&quot;</span></span><br><span class="line">         pageEncoding=<span class="string">&quot;UTF-8&quot;</span> <span class="keyword">import</span>=<span class="string">&quot;java.util.*&quot;</span>%&gt;</span><br><span class="line"></span><br><span class="line">&lt;%@ taglib uri=<span class="string">&quot;http://java.sun.com/jsp/jstl/core&quot;</span> prefix=<span class="string">&quot;c&quot;</span>%&gt;</span><br><span class="line"></span><br><span class="line">&lt;table align=<span class="string">&#x27;center&#x27;</span> border=<span class="string">&#x27;1&#x27;</span> cellspacing=<span class="string">&#x27;0&#x27;</span>&gt;</span><br><span class="line">    &lt;tr&gt;</span><br><span class="line">        &lt;td&gt;id&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;name&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;hp&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;damage&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;edit&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;delete&lt;/td&gt;</span><br><span class="line">    &lt;/tr&gt;</span><br><span class="line">    &lt;c:forEach items=<span class="string">&quot;$&#123;heros&#125;&quot;</span> <span class="keyword">var</span>=<span class="string">&quot;hero&quot;</span> varStatus=<span class="string">&quot;st&quot;</span>&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;td&gt;$&#123;hero.id&#125;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;$&#123;hero.name&#125;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;$&#123;hero.hp&#125;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;$&#123;hero.damage&#125;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;&lt;a href=&quot;editHero?id=$&#123;hero.id&#125;&quot;&gt;edit&lt;/a&gt;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;&lt;a href=&quot;deleteHero?id=$&#123;hero.id&#125;&quot;&gt;delete&lt;/a&gt;&lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">    &lt;/c:forEach&gt;</span><br><span class="line">&lt;/table&gt;</span><br></pre></td></tr></table></figure>

<p>web.xml</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee</span></span></span><br><span class="line"><span class="tag"><span class="string">                  http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">version</span>=<span class="string">&quot;4.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">metadata-complete</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>HeroListServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>top.v0w.servlet.HeroListServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>HeroListServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/listHero<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>HeroDeleteServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>top.v0w.servlet.HeroDeleteServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>HeroDeleteServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/deleteHero<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>CharEncodingFiler<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>top.v0w.filter.CharEncodingFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>CharEncodingFiler<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>


<h1 id="0x06-Filter"><a href="#0x06-Filter" class="headerlink" title="0x06 Filter"></a>0x06 Filter</h1><p>Filter就像一个一个哨卡，用户的请求需要经过Filter。并且可以有多个过滤器：</p>
<p><img src="https://image.v0w.top/2020/12/16091330778625.jpg" alt="过滤器"><br>自己编写的Filter需要实现<code>javax.servlet.Filter</code>接口</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> top.v0w.filter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.*;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CharactorEncodingFilter</span> <span class="keyword">implements</span> <span class="title">Filter</span> </span>&#123;</span><br><span class="line">    <span class="comment">//初始化: web服务器启动时，进行初始化</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(FilterConfig filterConfig)</span> <span class="keyword">throws</span> ServletException </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;过滤器初始化&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//实际过滤器</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(ServletRequest request, ServletResponse response, FilterChain chain)</span> <span class="keyword">throws</span> IOException, ServletException </span>&#123;</span><br><span class="line">        request.setCharacterEncoding(<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">        response.setCharacterEncoding(<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">        response.setContentType(<span class="string">&quot;text/html;charset=UTF-8&quot;</span>);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;chain 执行前&quot;</span>);</span><br><span class="line">        chain.doFilter(request,response);</span><br><span class="line">        System.out.println(<span class="string">&quot;chain 执行后&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 销毁: web服务器关闭时，才销毁</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;过滤器销毁&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>web.xml进行过滤器的注册</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>CharEncodingFiler<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>top.v0w.filter.CharactorEncodingFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>CharEncodingFiler<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/show<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="0x07-Listener-监听器"><a href="#0x07-Listener-监听器" class="headerlink" title="0x07 Listener 监听器"></a>0x07 Listener 监听器</h1><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> top.v0w.listener;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletContext;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSessionEvent;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSessionListener;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OnlineCountListener</span> <span class="keyword">implements</span> <span class="title">HttpSessionListener</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 创建Session监听，一旦创建Session，就会触发这个</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sessionCreated</span><span class="params">(HttpSessionEvent se)</span> </span>&#123;</span><br><span class="line">        ServletContext ctx = se.getSession().getServletContext();</span><br><span class="line">        Integer onlineCount = (Integer) ctx.getAttribute(<span class="string">&quot;OnlineCount&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(onlineCount == <span class="keyword">null</span>)&#123;</span><br><span class="line">            onlineCount = <span class="keyword">new</span> Integer(<span class="number">1</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">int</span> count = onlineCount.intValue();</span><br><span class="line">            onlineCount = <span class="keyword">new</span> Integer(count+<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        ctx.setAttribute(<span class="string">&quot;OnlineCount&quot;</span>,onlineCount);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 销毁Session监听，一旦Session销毁，会触发这个</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sessionDestroyed</span><span class="params">(HttpSessionEvent se)</span> </span>&#123;</span><br><span class="line">        ServletContext ctx = se.getSession().getServletContext();</span><br><span class="line">        Integer onlineCount = (Integer) ctx.getAttribute(<span class="string">&quot;OnlineCount&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(onlineCount == <span class="keyword">null</span>)&#123;</span><br><span class="line">            onlineCount = <span class="keyword">new</span> Integer(<span class="number">0</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">int</span> count = onlineCount.intValue();</span><br><span class="line">            onlineCount = <span class="keyword">new</span> Integer(count-<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        ctx.setAttribute(<span class="string">&quot;OnlineCount&quot;</span>,onlineCount);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>web.xml 注册监听器</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>top.v0w.listener.OnlineCountListener<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="0x08-JSON"><a href="#0x08-JSON" class="headerlink" title="0x08 JSON"></a>0x08 JSON</h1><h2 id="8-1-简介与简单使用"><a href="#8-1-简介与简单使用" class="headerlink" title="8.1 简介与简单使用"></a>8.1 简介与简单使用</h2><p>JSON JavaScript 对象表示法（JavaScript Object Notation） 是一种存储数据的方式。<br>以键值对的形式进行定义</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line"><span class="keyword">var</span> gareen = &#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;盖伦&quot;</span>,<span class="string">&quot;hp&quot;</span>:<span class="number">616</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">document</span>.write(<span class="string">&quot;英雄名称: &quot;</span> + gareen.name + <span class="string">&quot;&lt;br&gt;&quot;</span>);</span><br><span class="line"><span class="built_in">document</span>.write(<span class="string">&quot;英雄血量: &quot;</span> + gareen.hp + <span class="string">&quot;&lt;br&gt;&quot;</span>);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>通过方括号[] 创建JSON 数组，可以用类似数组的方式来获取单个对象</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">var</span> heros=</span><br><span class="line">[</span><br><span class="line">    &#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;盖伦&quot;</span>,<span class="string">&quot;hp&quot;</span>:<span class="number">616</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;提莫&quot;</span>,<span class="string">&quot;hp&quot;</span>:<span class="number">313</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;死歌&quot;</span>,<span class="string">&quot;hp&quot;</span>:<span class="number">432</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;火女&quot;</span>,<span class="string">&quot;hp&quot;</span>:<span class="number">389</span>&#125;</span><br><span class="line">]</span><br><span class="line"> </span><br><span class="line"><span class="built_in">document</span>.write(<span class="string">&quot;JSON数组大小&quot;</span>+heros.length);</span><br><span class="line"><span class="built_in">document</span>.write( <span class="string">&quot;第4个英雄是:&quot;</span> +  heros[<span class="number">3</span>].name);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p><strong>字符串转换成JSON对象</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line"><span class="keyword">var</span> s1 = <span class="string">&quot;&#123;\&quot;name\&quot;:\&quot;盖伦\&quot;&quot;</span>;</span><br><span class="line"><span class="keyword">var</span> s2 = <span class="string">&quot;,\&quot;hp\&quot;:616&#125;&quot;</span>;</span><br><span class="line"><span class="keyword">var</span> s3 = s1+s2;</span><br><span class="line"> </span><br><span class="line"><span class="built_in">document</span>.write(<span class="string">&quot;这是一个JSON格式的字符串:&quot;</span> + s3);</span><br><span class="line"><span class="built_in">document</span>.write(<span class="string">&quot;&lt;br&gt;&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> gareen = <span class="built_in">eval</span>(<span class="string">&quot;(&quot;</span>+s3+<span class="string">&quot;)&quot;</span>);</span><br><span class="line"><span class="built_in">document</span>.write(<span class="string">&quot;这是一个JSON对象: &quot;</span> + gareen);</span><br><span class="line">  </span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p><strong>JSON对象转换成字符串</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line"><span class="keyword">var</span> hero = &#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;盖伦&quot;</span>,<span class="string">&quot;hp&quot;</span>:<span class="string">&quot;616&quot;</span>&#125;;</span><br><span class="line"><span class="built_in">document</span>.write(<span class="string">&quot;这是一个json 对象：&quot;</span>+ hero);</span><br><span class="line"><span class="built_in">document</span>.write(<span class="string">&quot;&lt;br&gt;&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> heroString = <span class="built_in">JSON</span>.stringify(hero)</span><br><span class="line"><span class="built_in">document</span>.write(<span class="string">&quot;这是一个json 字符串：&quot;</span>+ heroString );</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h2 id="8-2-FastJson"><a href="#8-2-FastJson" class="headerlink" title="8.2 FastJson"></a>8.2 FastJson</h2><h3 id="8-2-1-简介"><a href="#8-2-1-简介" class="headerlink" title="8.2.1 简介"></a>8.2.1 简介</h3><p>Fastjson 是一个 Java 库，可以将 Java 对象转换为 JSON 格式，当然它也可以将 JSON 字符串转换为 Java 对象。<br>Fastjson 可以操作任何 Java 对象，即使是一些预先存在的没有源码的对象。<br>Fastjson 源码地址：<a target="_blank" rel="noopener" href="https://github.com/alibaba/fastjson">https://github.com/alibaba/fastjson</a></p>
<p>Fastjson 中文 Wiki：<a target="_blank" rel="noopener" href="https://github.com/alibaba/fastjson/wiki/Quick-Start-CN">https://github.com/alibaba/fastjson/wiki/Quick-Start-CN</a></p>
<h3 id="8-2-2-使用"><a href="#8-2-2-使用" class="headerlink" title="8.2.2 使用"></a>8.2.2 使用</h3><p>你可以在 maven 中央仓库中直接下载：<br><a target="_blank" rel="noopener" href="http://repo1.maven.org/maven2/com/alibaba/fastjson/">http://repo1.maven.org/maven2/com/alibaba/fastjson/</a><br>或者配置 maven 依赖:</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>fastjson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>x.x.x<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="8-2-3-将Java对象转换成Json格式字符串（序列化）"><a href="#8-2-3-将Java对象转换成Json格式字符串（序列化）" class="headerlink" title="8.2.3 将Java对象转换成Json格式字符串（序列化）"></a>8.2.3 将Java对象转换成Json格式字符串（序列化）</h3><p>JavaBean Person类</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> test.v0w;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.annotation.JSONField;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@JSONField(name = &quot;AGE&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@JSONField(name = &quot;FULL NAME&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String fullName;</span><br><span class="line"> </span><br><span class="line"> <span class="comment">// 这里的注解时factjson的注解，表示这个字段的序列化名称，还可以通过其他字段对filed转换json时进行不同的规定</span></span><br><span class="line">    <span class="meta">@JSONField(name = &quot;DATE OF BIRTH&quot;,format = &quot;yyyy-MM-dd&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Date dateOfBirth;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Person</span><span class="params">(<span class="keyword">int</span> age, String fullName, Date dateOfBirth)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">        <span class="keyword">this</span>.fullName= fullName;</span><br><span class="line">        <span class="keyword">this</span>.dateOfBirth = dateOfBirth;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// 标准 getters &amp; setters</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>FastJson.java 对Person对象进行序列化，转换成Json字符串</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> test.v0w;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;</span><br><span class="line"><span class="keyword">import</span> org.junit.Before;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Fastjson</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> List&lt;Person&gt; listOfPersons = <span class="keyword">new</span> ArrayList&lt;Person&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUp</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        listOfPersons.add(<span class="keyword">new</span> Person(<span class="number">15</span>, <span class="string">&quot;John Doe&quot;</span>, <span class="keyword">new</span> Date()));</span><br><span class="line">        listOfPersons.add(<span class="keyword">new</span> Person(<span class="number">20</span>, <span class="string">&quot;Janette Doe&quot;</span>, <span class="keyword">new</span> Date()));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">whenJavaList_thanConvertToJsonCorrect</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        String jsonOutput= JSON.toJSONString(listOfPersons);</span><br><span class="line">        System.out.println(jsonOutput);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[&#123;&quot;AGE&quot;:15,&quot;DATE OF BIRTH&quot;:&quot;2020-12-31&quot;,&quot;FULL NAME&quot;:&quot;John Doe&quot;&#125;,&#123;&quot;AGE&quot;:20,&quot;DATE OF BIRTH&quot;:&quot;2020-12-31&quot;,&quot;FULL NAME&quot;:&quot;Janette Doe&quot;&#125;]</span><br><span class="line"></span><br><span class="line">如果美化一下格式，输出：</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;AGE&quot;: 15, </span><br><span class="line">        &quot;DATE OF BIRTH&quot;: &quot;2020-12-31&quot;, </span><br><span class="line">        &quot;FULL NAME&quot;: &quot;John Doe&quot;</span><br><span class="line">    &#125;, </span><br><span class="line">    &#123;</span><br><span class="line">        &quot;AGE&quot;: 20, </span><br><span class="line">        &quot;DATE OF BIRTH&quot;: &quot;2020-12-31&quot;, </span><br><span class="line">        &quot;FULL NAME&quot;: &quot;Janette Doe&quot;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>我们可以通过定义不同的注解，指定进行Json序列化时，字段的不同行为：<br>比如自定义输出，控制字段的排序，日期显示格式，序列化标记等。</p>
<ul>
<li><p>format 参数用于格式化 date 属性。</p>
<ul>
<li><code>@JSONField(format=&quot;yyyyMMdd&quot;)</code></li>
</ul>
</li>
<li><p>默认情况下， FastJson 库可以序列化 Java bean 实体， 但我们可以使用 serialize 指定字段不序列化。</p>
<ul>
<li><code>@JSONField(deserialize=false)</code></li>
<li><code>@JSONField(serialize=false)</code></li>
</ul>
</li>
<li><p>使用 ordinal 参数指定字段的顺序</p>
<ul>
<li><code>@JSONField(ordinal = 1) Json序列化后第一个字段</code></li>
<li><code>@JSONField(ordinal = n) Json序列化后第n个字段</code></li>
</ul>
<p>具体可以参见<code>@JSONField</code>注解定义：<br><img src="https://image.v0w.top/2020/12/16093946207289.jpg" alt="reference"></p>
</li>
</ul>
<p><strong>JsonField配置方式</strong><br>FieldInfo 可以配置在 getter/setter 方法或者字段上。也可以直接配置在field字段上.</p>
<p><strong>FastJson BeanToArray序列化功能</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">String jsonOutput= JSON.toJSONString(listOfPersons, SerializerFeature.BeanToArray);</span><br></pre></td></tr></table></figure>
<p>输出结果为：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[</span><br><span class="line">    [</span><br><span class="line">        15, </span><br><span class="line">        &quot;2020-12-31&quot;, </span><br><span class="line">        &quot;John Doe&quot;</span><br><span class="line">    ], </span><br><span class="line">    [</span><br><span class="line">        20, </span><br><span class="line">        &quot;2020-12-31&quot;, </span><br><span class="line">        &quot;Janette Doe&quot;</span><br><span class="line">    ]</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>即直接对字段数据进行序列化，但是并不将其与FieldName对应。</p>
<h3 id="8-2-4-创建Json对象"><a href="#8-2-4-创建Json对象" class="headerlink" title="8.2.4 创建Json对象"></a>8.2.4 创建Json对象</h3><p>创建 JSON 对象非常简单，只需使用 JSONObject（fastJson提供的json对象） 和 JSONArray（fastJson提供json数组对象） 对象即可。</p>
<p>我们可以把JSONObject 当成一个 <code>Map&lt;String,Object&gt;</code> 来看，只是 JSONObject 提供了更为丰富便捷的方法，方便我们对于对象属性的操作。我们看一下源码。<br><img src="https://image.v0w.top/2020/12/16093954616523.jpg" alt="reference"></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">whenGenerateJson_thanGenerationCorrect</span><span class="params">()</span> <span class="keyword">throws</span> ParseException </span>&#123;</span><br><span class="line">    JSONArray jsonArray = <span class="keyword">new</span> JSONArray();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i++) &#123;</span><br><span class="line">        JSONObject jsonObject = <span class="keyword">new</span> JSONObject();</span><br><span class="line">        jsonObject.put(<span class="string">&quot;AGE&quot;</span>, <span class="number">10</span>);</span><br><span class="line">        jsonObject.put(<span class="string">&quot;FULL NAME&quot;</span>, <span class="string">&quot;Doe &quot;</span> + i);</span><br><span class="line">        jsonObject.put(<span class="string">&quot;DATE OF BIRTH&quot;</span>, <span class="string">&quot;2016/12/12 12:12:12&quot;</span>);</span><br><span class="line">        jsonArray.add(jsonObject);</span><br><span class="line">    &#125;</span><br><span class="line">    String jsonOutput = jsonArray.toJSONString();</span><br><span class="line">    System.out.println(jsonOutput);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="8-2-5-Json格式字符串解析成Java对象-反序列化"><a href="#8-2-5-Json格式字符串解析成Java对象-反序列化" class="headerlink" title="8.2.5 Json格式字符串解析成Java对象(反序列化)"></a>8.2.5 Json格式字符串解析成Java对象(反序列化)</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">whenJson_thanConvertToObjectCorrect</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Person person = <span class="keyword">new</span> Person(<span class="number">20</span>, <span class="string">&quot;John Doe&quot;</span>, <span class="keyword">new</span> Date());</span><br><span class="line">        System.out.println(<span class="string">&quot;Old Person: &quot;</span>+ person);</span><br><span class="line">        String jsonObject = JSON.toJSONString(person);</span><br><span class="line">        System.out.println(<span class="string">&quot;Json String: &quot;</span>+jsonObject);</span><br><span class="line"></span><br><span class="line">        Person newPerson = JSON.parseObject(jsonObject, Person.class);</span><br><span class="line">        System.out.println(<span class="string">&quot;New Person: &quot;</span>+ newPerson);</span><br><span class="line"></span><br><span class="line"><span class="comment">//        assertEquals(newPerson.getAge(), 20); // 如果我们设置序列化化为 default true</span></span><br><span class="line">        assertEquals(newPerson.getAge(), <span class="number">0</span>); <span class="comment">// 如果我们设置序列化化为 false</span></span><br><span class="line">        assertEquals(newPerson.getFullName(), listOfPersons.get(<span class="number">0</span>).getFullName()); <span class="comment">//assertEquals(expected,actual) 判断两个值是否相等</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>output：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Old Person: Person&#123;age&#x3D;20, fullName&#x3D;&#39;John Doe&#39;, dateOfBirth&#x3D;Thu Dec 31 14:33:25 CST 2020&#125;</span><br><span class="line">Json String: &#123;&quot;DATE OF BIRTH&quot;:&quot;2020-12-31&quot;,&quot;FULL NAME&quot;:&quot;John Doe&quot;&#125;</span><br><span class="line">New Person: Person&#123;age&#x3D;0, fullName&#x3D;&#39;John Doe&#39;, dateOfBirth&#x3D;Thu Dec 31 00:00:00 CST 2020&#125;</span><br></pre></td></tr></table></figure>

<h2 id="8-3-Jackson"><a href="#8-3-Jackson" class="headerlink" title="8.3 Jackson"></a>8.3 Jackson</h2><h3 id="8-3-1-简介"><a href="#8-3-1-简介" class="headerlink" title="8.3.1 简介"></a>8.3.1 简介</h3><p>Jackson框架是基于Java平台的一套数据处理工具，被称为“最好的Java Json解析器”。<br>Jackson框架包含了3个核心库：core,databind,annotations.<br>Jackson还包含了其它数据处理类库，此外不作说明。</p>
<ul>
<li><p>流式API - 读取并将JSON内容写入作为离散事件。 JsonParser读取数据，而JsonGenerator写入数据。它是三者中最有效的方法，是最低的开销和最快的读/写操作。它类似于Stax解析器XML。</p>
</li>
<li><p>树模型 - 准备JSON文件在内存里以树形式表示。 ObjectMapper构建JsonNode节点树。这是最灵活的方法。它类似于XML的DOM解析器。</p>
</li>
<li><p>数据绑定 - 转换JSON并从POJO（普通Java对象）使用属性访问或使用注释。它有两个类型。</p>
<ul>
<li>简单的数据绑定 - 转换JSON和Java Maps, Lists, Strings, Numbers, Booleans 和null 对象。</li>
<li>全部数据绑定 - 转换为JSON从任何JAVA类型。</li>
</ul>
</li>
<li><p>Jackson Home Page：<a target="_blank" rel="noopener" href="https://github.com/FasterXML/jackson">https://github.com/FasterXML/jackson</a></p>
</li>
<li><p>Jackson Wiki：<a target="_blank" rel="noopener" href="http://wiki.fasterxml.com/JacksonHome">http://wiki.fasterxml.com/JacksonHome</a></p>
</li>
<li><p>Jackson doc: <a target="_blank" rel="noopener" href="https://github.com/FasterXML/jackson-docs">https://github.com/FasterXML/jackson-docs</a></p>
</li>
<li><p>Jackson Download Page：<a target="_blank" rel="noopener" href="http://wiki.fasterxml.com/JacksonDownload">http://wiki.fasterxml.com/JacksonDownload</a></p>
</li>
<li><p>Jackson Guide Blog: <a target="_blank" rel="noopener" href="https://www.baeldung.com/jackson">https://www.baeldung.com/jackson</a></p>
</li>
</ul>
<p>maven pom.xml</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- jackson request jar package --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-databind<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.11.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.11.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-annotations<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.11.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="8-3-2-Java-对象转Json字符串"><a href="#8-3-2-Java-对象转Json字符串" class="headerlink" title="8.3.2 Java 对象转Json字符串"></a>8.3.2 Java 对象转Json字符串</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    ObjectMapper mapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">    Person person = <span class="keyword">new</span> Person(<span class="number">18</span>, <span class="string">&quot;V0WKeep3r&quot;</span>, <span class="keyword">new</span> Date());</span><br><span class="line">    File newFile=  <span class="keyword">new</span> File(<span class="string">&quot;/Users/v0w/Desktop/person.json&quot;</span>);</span><br><span class="line">    <span class="comment">// 序列化</span></span><br><span class="line">    <span class="comment">// 是否可以序列化</span></span><br><span class="line">    System.out.println(mapper.canSerialize(Person.class));</span><br><span class="line">    <span class="comment">// Json 写入文件</span></span><br><span class="line">    mapper.writeValue(newFile, person);</span><br><span class="line">    <span class="comment">// pojo -&gt; Json String</span></span><br><span class="line">    String jsonString = mapper.writeValueAsString(person);</span><br><span class="line">    System.out.println(jsonString);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>output:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">true</span><br><span class="line">&#123;&quot;age&quot;:18,&quot;fullName&quot;:&quot;V0WKeep3r&quot;,&quot;dateOfBirth&quot;:1609399813373&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Jackson注解</strong><br>与fastjson类似，Jackson也可以通过注解的方式对java类的filed进行设置，从而使其在序列化成json字符串时，呈现不同的形式。<br>1、 <code>@JsonPropertyOrder(&#123; &quot;name&quot;, &quot;id&quot; &#125;)</code>注解可以指定不同属性的输出顺序</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@JsonPropertyOrder(&#123; &quot;fullName&quot;, &quot;age&quot; , &quot;dateOfBirth&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line">    <span class="keyword">private</span> String fullName;</span><br><span class="line">    <span class="keyword">private</span> Date dateOfBirth;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// output</span></span><br><span class="line">&#123;<span class="string">&quot;fullName&quot;</span>:<span class="string">&quot;V0WKeep3r&quot;</span>,<span class="string">&quot;age&quot;</span>:<span class="number">18</span>,<span class="string">&quot;dateOfBirth&quot;</span>:<span class="number">1609400550595</span>&#125;</span><br></pre></td></tr></table></figure>

<p>2、<code>@JsonValue</code>指示库将用于序列化整个实例的单个方法。</p>
<p>例如，在一个枚举中，我们用@JsonValue注释getName，以便任何这样的实体都通过其名称序列化：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> TypeEnumWithValue &#123;</span><br><span class="line">    TYPE1(<span class="number">1</span>, <span class="string">&quot;Type A&quot;</span>), TYPE2(<span class="number">2</span>, <span class="string">&quot;Type 2&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// standard constructors</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@JsonValue</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>现在这是我们的测试：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">whenSerializingUsingJsonValue_thenCorrect</span><span class="params">()</span></span></span><br><span class="line"><span class="function">  <span class="keyword">throws</span> JsonParseException, IOException </span>&#123;</span><br><span class="line"> </span><br><span class="line">    String enumAsString = <span class="keyword">new</span> ObjectMapper()</span><br><span class="line">      .writeValueAsString(TypeEnumWithValue.TYPE1);</span><br><span class="line"></span><br><span class="line">    assertThat(enumAsString, is(<span class="string">&quot;&quot;</span>Type A<span class="string">&quot;&quot;</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>3、**@JsonRootName**<br><code>@JsonRootName</code>注释时，如果包裹被启用，以指定的包装中使用的根目录的名称。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;id&quot;: 1,</span><br><span class="line">    &quot;name&quot;: &quot;John&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>它会像这样包装：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;User&quot;: &#123;</span><br><span class="line">        &quot;id&quot;: 1,</span><br><span class="line">        &quot;name&quot;: &quot;John&quot;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>因此，让我们看一个例子。使用<code>@JsonRootName</code>注释，表明这个潜在的包装实体的名称：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">@JsonRootName(value &#x3D; &quot;user&quot;)</span><br><span class="line">public class UserWithRoot &#123;</span><br><span class="line">    public int id;</span><br><span class="line">    public String name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>默认情况下，包装器的名称将为类的名称–<code>UserWithRoot</code>。通过使用注释，我们得到了看上去更干净的<code>user</code>：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void whenSerializingUsingJsonRootName_thenCorrect()</span><br><span class="line">  throws JsonProcessingException &#123;</span><br><span class="line"></span><br><span class="line">    UserWithRoot user &#x3D; new User(1, &quot;John&quot;);</span><br><span class="line"></span><br><span class="line">    ObjectMapper mapper &#x3D; new ObjectMapper();</span><br><span class="line">    mapper.enable(SerializationFeature.WRAP_ROOT_VALUE);&#x2F;&#x2F;需要开启这个</span><br><span class="line">    String result &#x3D; mapper.writeValueAsString(user);</span><br><span class="line"></span><br><span class="line">    assertThat(result, containsString(&quot;John&quot;));</span><br><span class="line">    assertThat(result, containsString(&quot;user&quot;));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;user&quot;:&#123;</span><br><span class="line">        &quot;id&quot;:1,</span><br><span class="line">        &quot;name&quot;:&quot;John&quot;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>同样也可以用于xml的序列化封装，此处不提。<br>更多类似注解，请参考：<a target="_blank" rel="noopener" href="https://www.baeldung.com/jackson-annotations">https://www.baeldung.com/jackson-annotations</a></p>
<h3 id="8-3-3-Json-字符串转Java对象"><a href="#8-3-3-Json-字符串转Java对象" class="headerlink" title="8.3.3 Json 字符串转Java对象"></a>8.3.3 Json 字符串转Java对象</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> test.v0w;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.*;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.core.*;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.*;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Jackson</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        ObjectMapper mapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">        Person person = <span class="keyword">new</span> Person(<span class="number">18</span>, <span class="string">&quot;V0WKeep3r&quot;</span>, <span class="keyword">new</span> Date());</span><br><span class="line">        File newFile=  <span class="keyword">new</span> File(<span class="string">&quot;/Users/v0w/Desktop/person.json&quot;</span>);</span><br><span class="line">        <span class="comment">// 序列化</span></span><br><span class="line">        <span class="comment">// 是否可以序列化</span></span><br><span class="line">        System.out.println(mapper.canSerialize(Person.class));</span><br><span class="line">        <span class="comment">// Json 写入文件</span></span><br><span class="line">        mapper.writeValue(newFile, person);</span><br><span class="line">        <span class="comment">// pojo -&gt; Json String</span></span><br><span class="line">        String jsonString = mapper.writeValueAsString(person);</span><br><span class="line">        System.out.println(jsonString);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 反序列化</span></span><br><span class="line">        <span class="comment">// 从文件反序列化</span></span><br><span class="line">        Person p1 = mapper.readValue(<span class="keyword">new</span> File(<span class="string">&quot;/Users/v0w/Desktop/person.json&quot;</span>), Person.class);</span><br><span class="line">        System.out.println(p1);</span><br><span class="line">        <span class="comment">// 从json串反序列化</span></span><br><span class="line">        Person p2 = mapper.readValue(jsonString, Person.class);</span><br><span class="line">        System.out.println(p2);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// json Tree解析 此方式存在多种取数据的方法</span></span><br><span class="line">        JsonNode root = mapper.readTree(newFile);</span><br><span class="line">        System.out.println(root);</span><br><span class="line">        System.out.println(root.get(<span class="string">&quot;age&quot;</span>));</span><br><span class="line">        System.out.println(root.at(<span class="string">&quot;/fullName&quot;</span>));</span><br><span class="line">        System.out.println(root.findValue(<span class="string">&quot;dateOfBirth&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>output：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">true</span><br><span class="line">&#123;&quot;fullName&quot;:&quot;V0WKeep3r&quot;,&quot;age&quot;:18,&quot;dateOfBirth&quot;:1609400550595&#125;</span><br><span class="line">Person&#123;age&#x3D;18, fullName&#x3D;&#39;V0WKeep3r&#39;, dateOfBirth&#x3D;Thu Dec 31 15:42:30 CST 2020&#125;</span><br><span class="line">Person&#123;age&#x3D;18, fullName&#x3D;&#39;V0WKeep3r&#39;, dateOfBirth&#x3D;Thu Dec 31 15:42:30 CST 2020&#125;</span><br><span class="line">&#123;&quot;fullName&quot;:&quot;V0WKeep3r&quot;,&quot;age&quot;:18,&quot;dateOfBirth&quot;:1609400550595&#125;</span><br><span class="line">18</span><br><span class="line">&quot;V0WKeep3r&quot;</span><br><span class="line">1609400550595</span><br></pre></td></tr></table></figure>

<h2 id="8-4-Gson"><a href="#8-4-Gson" class="headerlink" title="8.4 Gson"></a>8.4 Gson</h2><p>Gson是Google开源的一个JSON库，被广泛应用在Android开发中。</p>
<p>maven pom.xml</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Gson --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.google.code.gson<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>gson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.8.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>创建Gson对象</strong><br>Gson提供了两种创建对象的方式：</p>
<ol>
<li>直接使用Gson构造方法创建:<code>Gson gson = new Gson();</code></li>
<li>使用GsonBuilder创建:<code>Gson gson = new GsonBuilder().create();</code></li>
</ol>
<p>相比直接使用构造方法，GsonBuilder创建的方式更灵活，因为它支持对Gson的配置。</p>
<p><strong>将对象转换为JSON</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> test.v0w;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.google.gson.*;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GsonTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        Person person = <span class="keyword">new</span> Person(<span class="number">18</span>, <span class="string">&quot;V0Wkeep3r&quot;</span>, <span class="keyword">new</span> Date());</span><br><span class="line">        Gson gson = <span class="keyword">new</span> GsonBuilder().create();</span><br><span class="line">        String jsonString = gson.toJson(person);</span><br><span class="line">        System.out.println(jsonString);</span><br><span class="line"></span><br><span class="line">        ArrayList&lt;Person&gt; accountList = <span class="keyword">new</span> ArrayList&lt;Person&gt;();</span><br><span class="line">        accountList.add(person);</span><br><span class="line">        System.out.println(gson.toJson(accountList));</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>结果：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;&quot;age&quot;:18,&quot;fullName&quot;:&quot;V0Wkeep3r&quot;,&quot;dateOfBirth&quot;:&quot;Dec 31, 2020 4:34:41 PM&quot;&#125;</span><br><span class="line">[&#123;&quot;age&quot;:18,&quot;fullName&quot;:&quot;V0Wkeep3r&quot;,&quot;dateOfBirth&quot;:&quot;Dec 31, 2020 4:34:41 PM&quot;&#125;]</span><br></pre></td></tr></table></figure>

<p><strong>将JSON转换为对象</strong></p>
<p>由于Java中的泛型存在类型擦除的问题，所以使用泛型接收JSON解析结果的时候有点特殊。</p>
<p><strong>普通对象解析</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Test_fromJson</span><span class="params">()</span></span>&#123;</span><br><span class="line">    Gson gson = <span class="keyword">new</span> GsonBuilder().create();</span><br><span class="line">    String JsonString = <span class="string">&quot;&#123;\&quot;age\&quot;:18,\&quot;fullName\&quot;:\&quot;V0Wkeep3r\&quot;,\&quot;dateOfBirth\&quot;:\&quot;Dec 31, 2020 4:34:41 PM\&quot;&#125;&quot;</span>;</span><br><span class="line">    Person person = gson.fromJson(JsonString, Person.class);</span><br><span class="line">    System.out.println(person);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>结果：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Person&#123;age&#x3D;18, fullName&#x3D;&#39;V0Wkeep3r&#39;, dateOfBirth&#x3D;Thu Dec 31 16:34:41 CST 2020&#125;</span><br></pre></td></tr></table></figure>

<p><strong>泛型对象解析</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Test_fromJson2</span><span class="params">()</span></span>&#123;</span><br><span class="line">    Gson gson = <span class="keyword">new</span> GsonBuilder().create();</span><br><span class="line">    String listJson = <span class="string">&quot;[&#123;\&quot;age\&quot;:18,\&quot;fullName\&quot;:\&quot;V0Wkeep3r\&quot;,\&quot;dateOfBirth\&quot;:\&quot;Dec 31, 2020 4:34:41 PM\&quot;&#125;]&quot;</span>;</span><br><span class="line">    List personList = gson.fromJson(listJson, <span class="keyword">new</span> TypeToken&lt;List&lt;Person&gt;&gt;()&#123;&#125;.getType());  <span class="comment">// new TypeToken&lt;List&lt;Person&gt;&gt;()&#123;&#125;.getType()</span></span><br><span class="line">    System.out.println(<span class="string">&quot;PersonList size = &quot;</span> + personList.size());</span><br><span class="line">    System.out.println(<span class="string">&quot;PersonList content = &quot;</span>+personList);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>结果：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">PersonList size &#x3D; 1</span><br><span class="line">PersonList content &#x3D; [Person&#123;age&#x3D;18, fullName&#x3D;&#39;V0Wkeep3r&#39;, dateOfBirth&#x3D;Thu Dec 31 16:34:41 CST 2020&#125;]</span><br></pre></td></tr></table></figure>

<p><strong>字段复用-@SerializedName注解进行重新命名</strong><br>在开发中有时会对Bean对象进行复用，但可能有几个字段的命名和当前的对象不一致，这样在解析JSON的时候就不能正确赋值。Gson提供了字段复用功能——<code>@SerializedName</code>，可用一个字段接收不同的JSON字段。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;&#x2F; json字符串中手机号的字段为phone或telNumber时都可正确解析</span><br><span class="line">@SerializedName(&quot;phone&quot;)</span><br><span class="line">private String telNumber;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; json字符串中用户名的字段为userName、user_name、uname或u_name时都可正确解析</span><br><span class="line">@SerializedName(value &#x3D; &quot;userName&quot;, alternate &#x3D; &#123;&quot;user_name&quot;, &quot;uname&quot;, &quot;u_name&quot;&#125;)</span><br><span class="line">private String userName;</span><br></pre></td></tr></table></figure>

<p><strong>Gson配置</strong></p>
<p>除了以上用法，Gson还提供了丰富的配置选项，包括：空值过滤，字段命名规则，自定义解析器，自定义序列化/反序列化等。</p>
<p><strong>空值问题</strong></p>
<p>Gson默认情况下会过滤空值字段，但有时在提交数据给后台时，即便字段为空，也需要传给后台，此时可通过GsonBuilder进行配置。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Test_null</span><span class="params">()</span></span>&#123;</span><br><span class="line">    Gson gson = <span class="keyword">new</span> GsonBuilder().serializeNulls().create();</span><br><span class="line">    Person account = <span class="keyword">new</span> Person(<span class="number">99</span>, <span class="string">&quot;Freeman&quot;</span>);</span><br><span class="line">    System.out.println(gson.toJson(account));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>结果：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;&quot;age&quot;:99,&quot;fullName&quot;:&quot;Freeman&quot;,&quot;dateOfBirth&quot;:null&#125;</span><br></pre></td></tr></table></figure>
<p>从结果可以看出，dataOfBirth字段被输出了，而前面直接创建Gson转换的时候没有输出dataOfBirth字段。</p>
<p>reference: <a target="_blank" rel="noopener" href="https://juejin.cn/post/6844903765603336206">https://juejin.cn/post/6844903765603336206</a></p>
<h1 id="0x09-Ajax"><a href="#0x09-Ajax" class="headerlink" title="0x09 Ajax"></a>0x09 Ajax</h1><p>通过AJAX Asynchronous JavaScript And XML 实现异步刷新</p>
<h2 id="9-1-用途"><a href="#9-1-用途" class="headerlink" title="9.1 用途"></a>9.1 用途</h2><p>在一些需要较为实时响应的情况下使用，比如想检测一个账号是否已经存在。<br>功能：<code>如果提交的用户名是abc就打印存在，否则就可以使用</code><br>想实现这个功能，我们可能需要通过jsp去查或者响应，但是怎么样都不是实时的。</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">&quot;java&quot;</span> contentType=<span class="string">&quot;text/html; charset=UTF-8&quot;</span></span><br><span class="line">    pageEncoding=<span class="string">&quot;UTF-8&quot;</span> isELIgnored=<span class="string">&quot;false&quot;</span>%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;%</span><br><span class="line">    String name = request.getParameter(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">     </span><br><span class="line">    <span class="keyword">if</span>(<span class="string">&quot;abc&quot;</span>.equals(name))</span><br><span class="line">        out.print(<span class="string">&quot;&lt;font color=&#x27;red&#x27;&gt;已经存在&lt;/font&gt;&quot;</span>);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        out.print(<span class="string">&quot;&lt;font color=&#x27;green&#x27;&gt;可以使用&lt;/font&gt;&quot;</span>);</span><br><span class="line">     </span><br><span class="line">%&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line"> </span><br><span class="line">&lt;a href=&quot;https://how2j.cn/study/checkName.jsp?name=abc&quot;&gt;checkName.jsp?name=abc&lt;/a&gt;</span><br><span class="line">&lt;br&gt;</span><br><span class="line">&lt;a href=&quot;https://how2j.cn/study/checkName.jsp?name=def&quot;&gt;checkName.jsp?name=def&lt;/a&gt;</span><br><span class="line"> </span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>而使用Ajax，可以实时响应这个账号是否存在。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">span</span>&gt;</span>输入账号 :<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">&quot;name&quot;</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">onkeyup</span>=<span class="string">&quot;check()&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">&quot;checkResult&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> xmlhttp;</span></span><br><span class="line"><span class="javascript"><span class="function"><span class="keyword">function</span> <span class="title">check</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">var</span> name = <span class="built_in">document</span>.getElementById(<span class="string">&quot;name&quot;</span>).value;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">var</span> url = <span class="string">&quot;https://how2j.cn/study/checkName.jsp?name=&quot;</span>+name;</span></span><br><span class="line"> </span><br><span class="line"><span class="javascript">  xmlhttp =<span class="keyword">new</span> XMLHttpRequest();</span></span><br><span class="line"><span class="javascript">  xmlhttp.onreadystatechange=checkResult; <span class="comment">//响应函数</span></span></span><br><span class="line"><span class="javascript">  xmlhttp.open(<span class="string">&quot;GET&quot;</span>,url,<span class="literal">true</span>);   <span class="comment">//设置访问的页面</span></span></span><br><span class="line"><span class="javascript">  xmlhttp.send(<span class="literal">null</span>);  <span class="comment">//执行访问</span></span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="javascript"><span class="function"><span class="keyword">function</span> <span class="title">checkResult</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line">  if (xmlhttp.readyState==4 &amp;&amp; xmlhttp.status==200)</span><br><span class="line"><span class="javascript">    <span class="built_in">document</span>.getElementById(<span class="string">&#x27;checkResult&#x27;</span>).innerHTML=xmlhttp.responseText;</span></span><br><span class="line">  </span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="https://image.v0w.top/2020/12/16093203006768.jpg"></p>
<h2 id="9-2-原理与编写"><a href="#9-2-原理与编写" class="headerlink" title="9.2 原理与编写"></a>9.2 原理与编写</h2><p><img src="https://image.v0w.top/2020/12/16093203639405.jpg" alt="原理图"></p>
<p><strong>1. 创建XHR对象</strong> XMLHttpRequest<br>XHR对象是一个javascript对象，它可以在用户没有感觉的情况下，就像背后运行的一根小线程一般，悄悄的和服务器进行数据交互<br>AJAX就是通过它做到无刷新效果的。</p>
<p><strong>2. 设置响应函数</strong><br>XHR对象的作用是和服务器进行交互，所以既会发消息给服务器，也能接受服务器返回的响应。<br>当服务器响应回来的时候，调用怎么处理呢？<br>通过 <code>xmlhttp.onreadystatechange=checkResult</code> 就可以指定用<code>checkResult</code> 函数进行处理。</p>
<p><strong>3. 设置并发出请求</strong><br>通过open函数设置背后的这个小线程，将要访问的页面url ，在本例中就是<br><code>/study/checkName.jsp</code></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">xmlhttp.open(&quot;GET&quot;,url,true);</span><br></pre></td></tr></table></figure>
<p>通过send函数进行实际的访问</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">xmlhttp.send(null);</span><br></pre></td></tr></table></figure>
<p>null表示没有参数，因为参数已经通过”GET” 方式，放在url里了。<br>只有在用”POST”，并且需要发送参数的时候，才会使用到send。<br>类似这样：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">xmlhttp.send(&quot;user&#x3D;&quot;+username+&quot;&amp;password&#x3D;&quot;+password)</span><br></pre></td></tr></table></figure>

<p><strong>4. 处理响应信息</strong><br>在checkResult 函数中处理响应</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">checkResult</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="keyword">if</span> (xmlhttp.readyState==<span class="number">4</span> &amp;&amp; xmlhttp.status==<span class="number">200</span>)</span><br><span class="line"><span class="built_in">document</span>.getElementById(<span class="string">&#x27;checkResult&#x27;</span>).innerHTML=xmlhttp.responseText;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>xmlhttp.readyState 4</code> 表示请求已完成<br><code>xmlhttp.status 200</code> 表示响应成功<br><code>xmlhttp.responseText;</code> 用于获取服务端传回来的文本<br><code>document.getElementById(&#39;checkResult&#39;).innerHTML</code> 设置span的内容为服务端传递回来的文本.<br><img src="https://image.v0w.top/2020/12/16093212087142.jpg"></p>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:v0wldl@163.com">V0WKeep3r</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://v0w.top/2020/12/30/JavaWebNote/">http://v0w.top/2020/12/30/JavaWebNote/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://v0w.top">V0W's Blog</a>！</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Java/">Java</a></div><div class="post-qr-code"><div class="post-qr-code-item"><img class="post-qr-code__img" src="/img/AlipayQR.png"><div class="post-qr-code__desc">支付宝打赏</div></div><div class="post-qr-code-item"><img class="post-qr-code__img" src="/img/wechatQR.png"><div class="post-qr-code__desc">微信打赏</div></div></div><nav id="pagination"><div class="next-post pull-right"><a href="/2020/12/29/Chrome-MixedContent/"><span>踩坑：谷歌Chrome浏览器默认https加载导致图片不显示&amp;如何解决</span><i class="fa fa-chevron-right"></i></a></div></nav><div id="vcomment"></div><script src="https://cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js"></script><script>var notify = 'false' == 'true';
var verify = 'false' == 'true';
var record_ip = 'false' == 'true';
var GUEST_INFO = ['nick','mail','link'];
var guest_info = 'nick,mail,link'.split(',').filter(function(item){
  return GUEST_INFO.indexOf(item) > -1
});
guest_info = guest_info.length == 0 ? GUEST_INFO :guest_info;
window.valine = new Valine({
  el:'#vcomment',
  notify:notify,
  verify:verify,
  recordIP:record_ip,
  appId:'xuqLRcah5FaInOgKRdj9JB3V-gzGzoHsz',
  appKey:'8vMPXnFoh7Fih1g29jw4JNxl',
  placeholder:'师傅可以留下你的评论和邮箱，V0W能够通过邮件get并回复哦～',
  avatar:'retro',
  guest_info:guest_info,
  pageSize:'10',
  lang: 'zh-cn'
})</script></div></div><footer class="footer-bg" style="background-image: url(/img/index.jpg)"><div class="layout" id="footer"><div class="copyright">&copy;2018 - 2021 By V0WKeep3r</div><div class="framework-info"><span>驱动 - </span><a target="_blank" rel="noopener" href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 - </span><a target="_blank" rel="noopener" href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.9.0"></script><script src="/js/fancybox.js?version=1.9.0"></script><script src="/js/sidebar.js?version=1.9.0"></script><script src="/js/copy.js?version=1.9.0"></script><script src="/js/fireworks.js?version=1.9.0"></script><script src="/js/transition.js?version=1.9.0"></script><script src="/js/scroll.js?version=1.9.0"></script><script src="/js/head.js?version=1.9.0"></script><script src="/js/search/local-search.js"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章"></div></div></div><hr><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a target="_blank" rel="noopener" href="https://github.com/wzpan/hexo-generator-search" style="color:#49B1F5;">hexo-generator-search</a>
 <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div></body></html>